<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<meta name="author" content="Thomas Diesler, James Netherton">
<title>WildFly Camel User Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>WildFly Camel User Guide</h1>
<div class="details">
<span id="author" class="author">Thomas Diesler</span><br>
<span id="author2" class="author">James Netherton</span><br>
<span id="revnumber">version 4.4.0-SNAPSHOT,</span>
<span id="revdate">2016-12-05</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_getting_started">1. Getting Started</a></li>
<li><a href="#_compatibility">2. Compatibility</a></li>
<li><a href="#_features">3. Features</a></li>
<li><a href="#_configuration">4. Configuration</a></li>
<li><a href="#_javaee_integration">5. JavaEE Integration</a>
<ul class="sectlevel2">
<li><a href="#_cdi">5.1. CDI</a></li>
<li><a href="#_ejb">5.2. EJB</a></li>
<li><a href="#_jaxb">5.3. JAXB</a></li>
<li><a href="#_jax_rs">5.4. JAX-RS</a></li>
<li><a href="#_jax_ws">5.5. JAX-WS</a></li>
<li><a href="#_jms">5.6. JMS</a></li>
<li><a href="#_jmx">5.7. JMX</a></li>
<li><a href="#_jndi">5.8. JNDI</a></li>
<li><a href="#_jpa">5.9. JPA</a></li>
</ul>
</li>
<li><a href="#_camel_components">6. Camel Components</a>
<ul class="sectlevel2">
<li><a href="#_camel_activemq">6.1. camel-activemq</a></li>
<li><a href="#_camel_atom">6.2. camel-atom</a></li>
<li><a href="#_camel_bean_validator">6.3. camel-bean-validator</a></li>
<li><a href="#_camel_bindy">6.4. camel-bindy</a></li>
<li><a href="#_camel_braintree">6.5. camel-braintree</a></li>
<li><a href="#_camel_cassandra">6.6. camel-cassandra</a></li>
<li><a href="#_camel_cdi">6.7. camel-cdi</a></li>
<li><a href="#_camel_crypto">6.8. camel-crypto</a></li>
<li><a href="#_camel_cxf">6.9. camel-cxf</a></li>
<li><a href="#_camel_dns">6.10. camel-dns</a></li>
<li><a href="#_camel_dozer">6.11. camel-dozer</a></li>
<li><a href="#_camel_ejb">6.12. camel-ejb</a></li>
<li><a href="#_camel_elasticsearch">6.13. camel-elasticsearch</a></li>
<li><a href="#_camel_file2">6.14. camel-file2</a></li>
<li><a href="#_camel_ftp">6.15. camel-ftp</a></li>
<li><a href="#_camel_hl7">6.16. camel-hl7</a></li>
<li><a href="#_camel_http4">6.17. camel-http4</a></li>
<li><a href="#_camel_hystrix">6.18. camel-hystrix</a></li>
<li><a href="#_camel_infinispan">6.19. camel-infinispan</a></li>
<li><a href="#_camel_irc">6.20. camel-irc</a></li>
<li><a href="#_camel_jasypt">6.21. camel-jasypt</a></li>
<li><a href="#_camel_jaxb">6.22. camel-jaxb</a></li>
<li><a href="#_camel_jdbc">6.23. camel-jdbc</a></li>
<li><a href="#_camel_jgroups">6.24. camel-jgroups</a></li>
<li><a href="#_camel_jms">6.25. camel-jms</a></li>
<li><a href="#_camel_jmx">6.26. camel-jmx</a></li>
<li><a href="#_camel_jpa">6.27. camel-jpa</a></li>
<li><a href="#_camel_jsch">6.28. camel-jsch</a></li>
<li><a href="#_camel_kafka">6.29. camel-kafka</a></li>
<li><a href="#_camel_ldap">6.30. camel-ldap</a></li>
<li><a href="#_camel_linkedin">6.31. camel-linkedin</a></li>
<li><a href="#_camel_lucene">6.32. camel-lucene</a></li>
<li><a href="#_camel_mail">6.33. camel-mail</a></li>
<li><a href="#_camel_metrics">6.34. camel-metrics</a></li>
<li><a href="#_camel_mina2">6.35. camel-mina2</a></li>
<li><a href="#_camel_mongodb">6.36. camel-mongodb</a></li>
<li><a href="#_camel_mqtt">6.37. camel-mqtt</a></li>
<li><a href="#_camel_mvel">6.38. camel-mvel</a></li>
<li><a href="#_camel_nats">6.39. camel-nats</a></li>
<li><a href="#_camel_netty4">6.40. camel-netty4</a></li>
<li><a href="#_camel_ognl">6.41. camel-ognl</a></li>
<li><a href="#_camel_olingo2">6.42. camel-olingo2</a></li>
<li><a href="#_camel_pdf">6.43. camel-pdf</a></li>
<li><a href="#_camel_quartz2">6.44. camel-quartz2</a></li>
<li><a href="#_camel_rest">6.45. camel-rest</a></li>
<li><a href="#_camel_rss">6.46. camel-rss</a></li>
<li><a href="#_camel_salesforce">6.47. camel-salesforce</a></li>
<li><a href="#_camel_sap">6.48. camel-sap</a></li>
<li><a href="#_camel_saxon">6.49. camel-saxon</a></li>
<li><a href="#_camel_script">6.50. camel-script</a></li>
<li><a href="#_camel_servicenow">6.51. camel-servicenow</a></li>
<li><a href="#_camel_servlet">6.52. camel-servlet</a></li>
<li><a href="#_camel_smpp">6.53. camel-smpp</a></li>
<li><a href="#_camel_spring">6.54. camel-spring</a></li>
<li><a href="#_camel_sql">6.55. camel-sql</a></li>
<li><a href="#_camel_stream">6.56. camel-stream</a></li>
<li><a href="#_camel_swagger">6.57. camel-swagger</a></li>
<li><a href="#_camel_twitter">6.58. camel-twitter</a></li>
<li><a href="#_camel_undertow">6.59. camel-undertow</a></li>
<li><a href="#_camel_velocity">6.60. camel-velocity</a></li>
<li><a href="#_camel_vertx">6.61. camel-vertx</a></li>
<li><a href="#_camel_weather">6.62. camel-weather</a></li>
<li><a href="#_camel_xstream">6.63. camel-xstream</a></li>
<li><a href="#_camel_zipkin">6.64. camel-zipkin</a></li>
<li><a href="#_camel_zookeeper">6.65. camel-zookeeper</a></li>
<li><a href="#_adding_components">6.66. Adding Components</a></li>
</ul>
</li>
<li><a href="#_data_formats">7. Data Formats</a></li>
<li><a href="#_languages">8. Languages</a></li>
<li><a href="#_cloud_integration">9. Cloud Integration</a>
<ul class="sectlevel2">
<li><a href="#_openshift_local">9.1. OpenShift Local</a></li>
<li><a href="#_openshift_on_ec2">9.2. OpenShift on EC2</a></li>
<li><a href="#_source_to_image">9.3. Source To Image</a></li>
</ul>
</li>
<li><a href="#_security_6">10. Security</a>
<ul class="sectlevel2">
<li><a href="#_jax_rs_security">10.1. JAX-RS Security</a></li>
<li><a href="#_jax_ws_security">10.2. JAX-WS Security</a></li>
<li><a href="#_jms_security">10.3. JMS Security</a></li>
<li><a href="#_route_policy">10.4. Route Policy</a></li>
</ul>
</li>
<li><a href="#_developer_info">11. Developer Info</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#169; 2016 The original authors.</p>
</div>
<div class="paragraph">
<p>Provides <a href="http://camel.apache.org" target="_blank">Apache Camel</a> integration with the <a href="http://wildfly.org" target="_blank">WildFly Application Server</a>.</p>
</div>
<div class="paragraph">
<p>The WildFly-Camel subsystem allows you to add Camel Routes as part of the WildFly configuration. Routes can be deployed as part of JavaEE applications. JavaEE components can access the Camel Core API and various Camel Component APIs.</p>
</div>
<div class="paragraph">
<p>Your Enterprise Integration Solution can be architected as a combination of JavaEE and Camel functionality.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">1. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter takes you through the first steps of getting WildFly-Camel and provides the initial pointers to get up and running.</p>
</div>
<h3 id="_download_the_distribution" class="discrete">Download the Distribution</h3>
<div class="paragraph">
<p>WildFly Camel is distributed as</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>WildFly Patch - <a href="https://github.com/wildflyext/wildfly-camel/releases">wildfly-camel-patch</a></p>
</li>
<li>
<p>Docker Image - <a href="https://registry.hub.docker.com/u/wildflyext/wildfly-camel/">wildflyext/wildfly-camel</a></p>
</li>
</ol>
</div>
<h3 id="_installing_the_camel_subsystem" class="discrete">Installing the Camel Subsystem</h3>
<div class="paragraph">
<p>Simply unpack the provided patch into the a supported WildFly installation. For possible WildFly target versions, see the <a href="index.html#_compatibility">compatibility page</a>.</p>
</div>
<h3 id="_standalone_server" class="discrete">Standalone Server</h3>
<div class="paragraph">
<p>In your WildFly home directory run &#8230;&#8203;</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ bin/standalone.sh -c standalone-camel.xml
...
10:50:02,833 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 31) JBAS018559: Deployed "wildfly-camel.war" (runtime-name : "wildfly-camel.war")
10:50:02,834 INFO  [org.jboss.as.server] (ServerService Thread Pool -- 31) JBAS018559: Deployed "hawtio.war" (runtime-name : "hawtio.war")
10:50:02,848 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015961: Http management interface listening on http://127.0.0.1:9990/management
10:50:02,849 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015951: Admin console listening on http://127.0.0.1:9990
10:50:02,849 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015874: WildFly 8.1.0.Final "Kenny" started in 10804ms</pre>
</div>
</div>
<h3 id="_domain_mode" class="discrete">Domain Mode</h3>
<div class="paragraph">
<p>Similarly, for the WildFly Domain Mode run &#8230;&#8203;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ bin/domain.sh -c domain-camel.xml</pre>
</div>
</div>
<h3 id="_enable_camel_subsystem" class="discrete">Enable Camel Subsystem</h3>
<div class="paragraph">
<p>The patch does not modify existing configuration files. Instead it comes with a number of additional configurations files that end in <code>-camel.xml</code>.</p>
</div>
<div class="paragraph">
<p>If you should want to add the Camel subsystem to existing configurations you can run the following command.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ bin/fuseconfig.sh --configs=camel --enable
Processing config for: camel
   Writing 'layers=fuse' to: .../wildfly-9.0.0.CR1/modules/layers.conf
   Enable camel configuration in: .../wildfly-9.0.0.CR1/standalone/configuration/standalone.xml
   Enable camel configuration in: .../wildfly-9.0.0.CR1/standalone/configuration/standalone-full.xml
   Enable camel configuration in: .../wildfly-9.0.0.CR1/standalone/configuration/standalone-full-ha.xml
   Enable camel configuration in: .../wildfly-9.0.0.CR1/standalone/configuration/standalone-ha.xml
   Enable camel configuration in: .../wildfly-9.0.0.CR1/domain/configuration/domain.xml</pre>
</div>
</div>
<div class="paragraph">
<p>There are currently three triggers that can be used to enable Camel for a deployment</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>a deployment that contains a *-camel-context.xml descriptor</p>
</li>
<li>
<p>a deployment that contains a type annotated with @CamelAware</p>
</li>
<li>
<p>a deployment that contains a type annotated with @ContextName</p>
</li>
</ol>
</div>
<h3 id="_docker_image" class="discrete">Docker Image</h3>
<div class="paragraph">
<p>The easiest and most portable way to run WildFly-Camel is to use the <a href="https://registry.hub.docker.com/u/wildflyext/wildfly-camel">wildflyext/wildfly-camel</a> distribution.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">$ docker run --rm -ti -p 8080:8080 -p 9990:9990 -e WILDFLY_MANAGEMENT_USER=admin -e WILDFLY_MANAGEMENT_PASSWORD=admin wildflyext/wildfly-camel</pre>
</div>
</div>
<h3 id="_maven_archetypes" class="discrete">Maven Archetypes</h3>
<div class="paragraph">
<p>To get started with writing Camel JEE applications, there are two Maven archetypes that can generate either a Camel Spring XML or Camel CDI application.</p>
</div>
<div class="paragraph">
<p>To generate a Camel CDI application, run the following from the command line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>mvn archetype:generate -DarchetypeGroupId=org.wildfly.camel.archetypes \
                       -DarchetypeArtifactId=wildfly-camel-archetype-cdi \
                       -DarchetypeVersion=4.4.0 \
                       -DgroupId=com.mycompany \
                       -DartifactId=my-camel-cdi-application</code></pre>
</div>
</div>
<div class="paragraph">
<p>To generate a Camel Spring XML application, run the following from the command line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>mvn archetype:generate -DarchetypeGroupId=org.wildfly.camel.archetypes \
                       -DarchetypeArtifactId=wildfly-camel-archetype-spring \
                       -DarchetypeVersion=4.4.0 \
                       -DgroupId=com.mycompany \
                       -DartifactId=my-camel-spring-application</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instructions on how to build, test and run the project can be found within the generated README files.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_compatibility">2. Compatibility</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The WildFly compatibility matrix</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 60%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>10.1.0.Final</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>10.0.0.Final</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.0, 4.1, 4.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>9.0.2.Final</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.2, 3.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>9.0.1.Final</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>9.0.0.CR1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>8.2.0.Final</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.1, 2.2, 2.3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>8.1.0.Final</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.0</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_features">3. Features</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides more detailed information about WildFly-Camel features.</p>
</div>
<h3 id="_camel_context_definitions" class="discrete">Camel Context Definitions</h3>
<div class="paragraph">
<p>Camel Contexts can be configured in standalone-camel.xml and domain.xml as part of the subsystem definition like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:camel:1.0"&gt;
   &lt;camelContext id="system-context-1"&gt;
     &lt;![CDATA[
     &lt;route&gt;
       &lt;from uri="direct:start"/&gt;
       &lt;transform&gt;
         &lt;simple&gt;Hello #{body}&lt;/simple&gt;
       &lt;/transform&gt;
     &lt;/route&gt;
     ]]&gt;
   &lt;/camelContext&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<h3 id="_camel_context_deployments" class="discrete">Camel Context Deployments</h3>
<div class="paragraph">
<p>Camel contexts can be deployed to WildFly with a <strong>-camel-context.xml</strong> suffix.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>As a standalone XML file</p>
</li>
<li>
<p>As part of another supported deployment</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A deployment may contain multiple <strong>-camel-context.xml</strong> files.</p>
</div>
<div class="paragraph">
<p>A deployed Camel context is CDI injectable like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Resource(name = "java:jboss/camel/context/mycontext")
CamelContext camelContext;</code></pre>
</div>
</div>
<h3 id="_management_console" class="discrete">Management Console</h3>
<div class="paragraph">
<p>By default, access to management consoles is secured. We therefore need to setup a Management User first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ bin/add-user.sh

What type of user do you wish to add?
 a) Management User (mgmt-users.properties)
 b) Application User (application-users.properties)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="http://hawt.io" target="_blank">Hawt.io</a> console should show the camel context from subsystem configuration.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/hawtio-camel-01.png" alt="hawtio camel 01">
</div>
</div>
<h3 id="_arquillian_test_support" class="discrete">Arquillian Test Support</h3>
<div class="paragraph">
<p>The WildFly Camel test suite uses the WildFly <a href="http://arquillian.org/" target="_blank">Arquillian</a> managed container. This can connect to an already running WildFly instance or alternatively start up a standalone server instance when needed.</p>
</div>
<div class="paragraph">
<p>A number of test enrichers have been implemented that allow you to have these WildFly Camel specific types injected into your Arquillian test cases.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@ArquillianResource
CamelContextFactory contextFactory;

@ArquillianResource
CamelContextRegistry contextRegistry;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">4. Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter details information about the Camel subsytem and deployment configuration.</p>
</div>
<h3 id="_camel_subsystem_configuration" class="discrete">Camel Subsystem Configuration</h3>
<div class="paragraph">
<p>The subsystem configuration may contain static system routes</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:camel:1.0"&gt;
   &lt;camelContext id="system-context-1"&gt;
     &lt;![CDATA[
     &lt;route&gt;
       &lt;from uri="direct:start"/&gt;
       &lt;transform&gt;
         &lt;simple&gt;Hello #{body}&lt;/simple&gt;
       &lt;/transform&gt;
     &lt;/route&gt;
     ]]&gt;
   &lt;/camelContext&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>These routes are started automatically.</p>
</div>
<h3 id="_camel_deployment_configuration" class="discrete">Camel Deployment Configuration</h3>
<div class="paragraph">
<p>If you want to fine tune the default configuration of your Camel deployment, you can edit either the <code>WEB-INF/jboss-all.xml</code> or <code>META-INF/jboss-all.xml</code> configuration file in your deployment.</p>
</div>
<div class="paragraph">
<p>Use a <code>&lt;jboss-camel&gt;</code> XML element within the <code>jboss-all.xml</code> file to control the camel configuration.</p>
</div>
<h4 id="_disabling_the_camel_subsystem" class="discrete">Disabling the Camel Subsystem</h4>
<div class="paragraph">
<p>If you don&#8217;t want the camel subsystem to be added into
your deployment, set the <code>enabled="false"</code> attribute on the <code>jboss-camel</code> XML element.</p>
</div>
<div class="paragraph">
<p>Example <code>jboss-all.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;jboss umlns="urn:jboss:1.0"&gt;
  &lt;jboss-camel xmlns="urn:jboss:jboss-camel:1.0" enabled="false"/&gt;
&lt;/jboss&gt;</code></pre>
</div>
</div>
<h4 id="_selecting_components" class="discrete">Selecting Components</h4>
<div class="paragraph">
<p>If you add nested <code>&lt;component&gt;</code> or <code>&lt;component-module&gt;</code> XML elements, then instead of adding the default list of Camel components to your deployment, only the specified components will be added to your deployment.</p>
</div>
<div class="paragraph">
<p>Example <code>jboss-all.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;jboss umlns="urn:jboss:1.0"&gt;
  &lt;jboss-camel xmlns="urn:jboss:jboss-camel:1.0"&gt;
    &lt;component name="camel-ftp"/&gt;
    &lt;component-module name="org.apache.camel.component.rss"/&gt;
  &lt;/jboss-camel&gt;
&lt;/jboss&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_javaee_integration">5. JavaEE Integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter details information about integration points with JavaEE.</p>
</div>
<div class="sect2">
<h3 id="_cdi">5.1. CDI</h3>
<div class="paragraph">
<p>CDI integration is provided by <a href="http://camel.apache.org/cdi.html" target="_blank">camel-cdi</a>.</p>
</div>
<div class="paragraph">
<p>A Context with an associated route can be provided like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Startup
@ApplicationScoped
@ContextName("cdi-context")
public class MyRouteBuilder extends RouteBuilder {

    @Override
    public void configure() throws Exception {
    	from("direct:start").transform(body().prepend("Hi"));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and consumed like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Inject
@ContextName("cdi-context")
private CamelContext camelctx;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ejb">5.2. EJB</h3>
<div class="paragraph">
<p>Management support is provided through the <a href="http://camel.apache.org/jmx.html" target="_blank">camel-ejb</a> component which integrates with the EJB3 subsystem.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
    camelctx.addRoutes(new RouteBuilder() {
        @Override
        public void configure() throws Exception {
            from("direct:start").to("ejb:java:module/HelloBean");
        }
    });</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jaxb">5.3. JAXB</h3>
<div class="paragraph">
<p>JAXB support is provided through the <a href="http://camel.apache.org/jaxb.html" target="_blank">Camel JAXB data format</a>.</p>
</div>
<div class="paragraph">
<p>Camel supports unmarshalling XML data to JAXB annotated classes and marshalling from classes to XML. What follows demonstrates a simple Camel route for marshalling and unmarshalling with the Camel JAXB data format class.</p>
</div>
<div class="sect3">
<h4 id="_jaxb_annotated_class">5.3.1. JAXB Annotated class</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@XmlRootElement(name = "customer")
@XmlAccessorType(XmlAccessType.FIELD)
public class Customer implements Serializable {

    private String firstName;
    private String lastName;

    public Customer() {
    }

    public Customer(String firstName, String lastName) {
        this.firstName = firstName;
        this.lastName = lastName;
    }

    public String getFirstName() {
        return firstName;
    }

    public void setFirstName(String firstName) {
        this.firstName = firstName;
    }

    public String getLastName() {
        return lastName;
    }

    public void setLastName(String lastName) {
        this.lastName = lastName;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jaxb_class_xml_representation">5.3.2. JAXB Class XML representation</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;customer xmlns="http://org/wildfly/test/jaxb/model/Customer"&gt;
    &lt;firstName&gt;John&lt;/firstName&gt;
    &lt;lastName&gt;Doe&lt;/lastName&gt;
&lt;/customer&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_camel_jaxb_unmarshalling">5.3.3. Camel JAXB Unmarshalling</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">WildFlyCamelContext camelctx = contextFactory.createCamelContext(getClass().getClassLoader());

final JaxbDataFormat jaxb = new JaxbDataFormat();
jaxb.setContextPath("org.wildfly.camel.test.jaxb.model");

camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:start")
        .unmarshal(jaxb);
    }
});
camelctx.start();

ProducerTemplate producer = camelctx.createProducerTemplate();

// Send an XML representation of the customer to the direct:start endpoint
Customer customer = producer.requestBody("direct:start", readCustomerXml(), Customer.class);
Assert.assertEquals("John", customer.getFirstName());
Assert.assertEquals("Doe", customer.getLastName());</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_camel_jaxb_marshalling">5.3.4. Camel JAXB Marshalling</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">WildFlyCamelContext camelctx = contextFactory.createCamelContext();

final JaxbDataFormat jaxb = new JaxbDataFormat();
jaxb.setContextPath("org.wildfly.camel.test.jaxb.model");

camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:start")
        .marshal(jaxb);
    }
});
camelctx.start();

ProducerTemplate producer = camelctx.createProducerTemplate();
Customer customer = new Customer("John", "Doe");
String customerXML = producer.requestBody("direct:start", customer, String.class);
Assert.assertEquals(readCustomerXml(), customerXML);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jax_rs">5.4. JAX-RS</h3>
<div class="paragraph">
<p>JAX-RS support is provided by <a href="http://camel.apache.org/cxfrs.html" target="_blank">Camel CXF-RS</a>.</p>
</div>
<div class="sect3">
<h4 id="_cxf_rs_producer">5.4.1. CXF-RS Producer</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:cxf="http://camel.apache.org/schema/cxf"
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd
        http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd"&gt;

    &lt;cxf:rsClient id="cxfProducer"
                  address="http://localhost:8080/rest"
                  serviceClass="org.wildfly.camel.examples.cxf.jaxrs.GreetingService" /&gt;

    &lt;camelContext id="cxfrs-camel-context" xmlns="http://camel.apache.org/schema/spring"&gt;
        &lt;route&gt;
            &lt;from uri="direct:start" /&gt;
            &lt;setHeader headerName="operationName"&gt;
                &lt;simple&gt;greet&lt;/simple&gt;
            &lt;/setHeader&gt;
            &lt;setHeader headerName="CamelCxfRsUsingHttpAPI"&gt;
                &lt;constant&gt;false&lt;/constant&gt;
            &lt;/setHeader&gt;
            &lt;to uri="cxfrs:bean:cxfProducer" /&gt;
        &lt;/route&gt;
    &lt;/camelContext&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cxf_rs_consumer">5.4.2. CXF-RS Consumer</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:cxf="http://camel.apache.org/schema/cxf"
    xsi:schemaLocation="
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd
        http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd"&gt;

    &lt;cxf:rsServer id="cxfConsumer"
                  address="http://localhost:8080/rest"
                  serviceClass="org.wildfly.camel.examples.cxf.jaxrs.GreetingService" /&gt;

    &lt;camelContext id="cxfrs-camel-context" xmlns="http://camel.apache.org/schema/spring"&gt;
        &lt;route&gt;
            &lt;from uri="cxfrs:bean:cxfConsumer" /&gt;
            &lt;setBody&gt;
                &lt;constant&gt;Hello world&lt;/constant&gt;
            &lt;/setBody&gt;
        &lt;/route&gt;
    &lt;/camelContext&gt;
&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jax_rs_consumer_with_the_camel_rest_dsl">5.4.3. JAX-RS Consumer with the Camel REST DSL</h4>
<div class="paragraph">
<p>The Camel REST DSL gives the capability to write Camel routes that act as JAX-RS consumers. The following RouteBuilder class demonstrates this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Startup
@ApplicationScoped
@ContextName("rest-camel-context")
public class RestConsumerRouteBuilder extends RouteBuilder {
  @Override
  public void configure() throws Exception {

    // Use the camel-servlet component to provide REST integration
    restConfiguration().component("servlet")
      .contextPath("/rest").port(8080).bindingMode(RestBindingMode.json);

    rest("/customer")
      // GET /rest/customer
      .get()
        .produces(MediaType.APPLICATION_JSON)
        .to("direct:getCustomers")
      // GET /rest/customer/1
      .get("/{id}")
        .produces(MediaType.APPLICATION_JSON)
        .to("direct:getCustomer")
      // POST /rest/customer
      .post()
        .type(Customer.class)
        .to("direct:createCustomer");
      // PUT /rest/customer
      .put()
        .type(Customer.class)
        .to("direct:updateCustomer");
      // DELETE /rest/customer/1
      .delete("/{id}")
        .to("direct:deleteCustomer");
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the REST DSL configuration starts with <code>restConfiguration().component("servlet")</code>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The WildFly Camel Subsystem only supports the camel-servlet and camel-undertow components for use with the REST DSL. Attempts to configure other components will not work.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By setting the binding mode, Camel can marshal and unmarshal JSON data either by specifying a 'produces()' or 'type()' configuration step.</p>
</div>
</div>
<div class="sect3">
<h4 id="_jax_rs_consumer_with_camelproxy">5.4.4. JAX-RS Consumer with CamelProxy</h4>
<div class="paragraph">
<p>JAX-RS consumer endpoints can be configured using the <a href="http://camel.apache.org/using-camelproxy.html" target="_blank">CamelProxy</a>. The proxy enables
you to proxy a producer sending to an Endpoint by a regular interface. When clients invoke methods on this interface, the proxy performs a request / reply to a specified endpoint.</p>
</div>
<div class="paragraph">
<p>Below is an example JAX-RS service interface and implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">// Service interface
@Path("/customer")
public interface CustomerService {

  @GET
  @Produces(MediaType.APPLICATION_JSON)
  Response getCustomers();

  @PUT
  Response updateCustomer();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">// Service implementation
public class CustomerServiceImpl implements CustomerService {
  @Inject
  @ContextName("rest-camel-context")
  private CamelContext context;

  @Produce(uri="direct:rest")
  private CustomerService customerServiceProxy;

  @Override
  public Response getCustomers() {
    return customerServiceProxy.getCustomers();
  }

  @Override
  public Response updateCustomer(Customer customer) {
    return customerServiceProxy.updateCustomer(customer);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice in the above code example that <code>CustomerServiceImpl</code> delegates all method calls to a customerServiceProxy object which has been annotated
with <code>@Produce</code>. This annotation is important as it configures a proxy for the <code>direct:rest</code> endpoint against the <code>CustomerService</code> interface. Whenever any of the REST service methods are invoked by clients, the <code>direct:rest</code> camel route is triggered.</p>
</div>
<div class="paragraph">
<p>The RouteBuilder class implements logic for each REST service method invocation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">from("direct:rest")
  .process(new Processor() {
      @Override
      public void process(Exchange exchange) throws Exception {
        BeanInvocation beanInvocation = exchange.getIn().getBody(BeanInvocation.class);
        String methodName = beanInvocation.getMethod().getName();</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>      if (methodName.equals("getCustomers")) {
        List&lt;Customer&gt; customers = customerService.findAllCustomers();
        exchange.getOut().setBody(Response.ok(customers).build());
      } else if(methodName.equals("updateCustomer")) {
        Customer updatedCustomer = (Customer) beanInvocation.getArgs()[0];
        customerService.updateCustomer(updatedCustomer);
        exchange.getOut().setBody(Response.ok().build());
      }
    }
});</pre>
</div>
</div>
<div class="paragraph">
<p>In the above RouteBuilder a <code>Processor</code> handles REST service method invocations that have been proxied through the <code>direct:rest</code> endpoint.
The exchange message body will be an instance of <code>BeanInvocation</code>. This can be used to determine which web service method was invoked and
what arguments were passed to it. In this example some simple logic is used to return results to the client based on the name of the method that
was called.</p>
</div>
</div>
<div class="sect3">
<h4 id="_security">5.4.5. Security</h4>
<div class="paragraph">
<p>Refer to the <a href="index.html#_jax_rs_security">JAX-RS security section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_examples_on_github">5.4.6. Code examples on GitHub</h4>
<div class="paragraph">
<p>An example <a href="https://github.com/wildfly-extras/wildfly-camel-examples/tree/master/camel-cxf-jaxrs" target="_blank">Camel CXF application</a> is available on GitHub.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jax_ws">5.5. JAX-WS</h3>
<div class="paragraph">
<p>WebService support is provided through the <a href="http://camel.apache.org/cxf.html" target="_blank">camel-cxf</a>
component which integrates with the WildFly WebServices subsystem that also uses <a href="http://cxf.apache.org/" target="_blank">Apache CXF</a>.</p>
</div>
<div class="sect3">
<h4 id="_jax_ws_cxf_producer">5.5.1. JAX-WS CXF Producer</h4>
<div class="paragraph">
<p>The following code example uses CXF to consume a web service which has been deployed by the <a href="https://docs.jboss.org/author/display/WFLY8/JAX-WS+User+Guide" target="_blank">WildFly web services subsystem</a>.</p>
</div>
<div class="sect4">
<h5 id="_jax_ws_web_service">JAX-WS web service</h5>
<div class="paragraph">
<p>The following simple web service has a simple 'greet' method which will concatenate two string arguments together
and return them.</p>
</div>
<div class="paragraph">
<p>When the WildFly web service subsystem detects classes containing JAX-WS annotations, it bootstraps a CXF endpoint. In this example
the service endpoint will be located at <a href="http://hostname:port/context-root/greeting" class="bare">http://hostname:port/context-root/greeting</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">// Service interface
@WebService(name = "greeting")
public interface GreetingService {
    @WebMethod(operationName = "greet", action = "urn:greet")
    String greet(@WebParam(name = "message") String message, @WebParam(name = "name") String name);
}

// Service implementation
public class GreetingServiceImpl implements GreetingService{
    public String greet(String message, String name) {
        return message + " " + name ;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_camel_route_configuration">Camel route configuration</h5>
<div class="paragraph">
<p>This RouteBuilder configures a CXF producer endpoint which will consume the 'greeting' web service defined above. CDI in conjunction with the camel-cdi component
is used to bootstrap the RouteBuilder and CamelContext.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Startup
@ApplicationScoped
@ContextName("cxf-camel-context")
public class CxfRouteBuilder extends RouteBuilder {

    @Override
    public void configure() throws Exception {
        from("direct:start")
        .to("cxf://http://localhost:8080/example-camel-cxf/greeting?serviceClass=" + GreetingService.class.getName());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The greeting web service 'greet' requires two parameters. These can be supplied to the above route by way of a <code>ProducerTemplate</code>.
The web service method argument values are configured by constructing an object array which is passed as the exchange body.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">String message = "Hello"
String name = "Kermit"

ProducerTemplate producer = camelContext.createProducerTemplate();
Object[] serviceParams = new Object[] {message, name};
String result = producer.requestBody("direct:start", serviceParams, String.class);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_camel_cxf_jax_ws_consumer">5.5.2. Camel CXF JAX-WS Consumer</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:cxf="http://camel.apache.org/schema/cxf"
       xsi:schemaLocation="
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://camel.apache.org/schema/cxf http://camel.apache.org/schema/cxf/camel-cxf.xsd
        http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd"&gt;

    &lt;cxf:cxfEndpoint id="cxfConsumer"
                     address="http://localhost:8080/webservices/greeting"
                     serviceClass="org.wildfly.camel.examples.cxf.jaxws.GreetingService" /&gt;

    &lt;camelContext id="cxfws-camel-context" xmlns="http://camel.apache.org/schema/spring"&gt;
        &lt;route&gt;
            &lt;from uri="cxf:bean:cxfConsumer" /&gt;
            &lt;to uri="log:ws" /&gt;
        &lt;/route&gt;
    &lt;/camelContext&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jax_ws_consumer_with_camelproxy">5.5.3. JAX-WS Consumer with CamelProxy</h4>
<div class="paragraph">
<p>JAX-WS consumer endpoints can be configured using the <a href="http://camel.apache.org/using-camelproxy.html" target="_blank">CamelProxy</a>. The proxy enables
you to proxy a producer sending to an Endpoint by a regular interface. When clients invoke methods on this interface, the proxy performs a request / reply to a specified endpoint.</p>
</div>
<div class="paragraph">
<p>Below is an example JAX-WS web service interface and implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">// Service interface
@WebService(name = "greeting")
public interface GreetingService {
    @WebMethod(operationName = "greet", action = "urn:greet")
    String greet(@WebParam(name = "name") String name);

    @WebMethod(operationName = "greetWithMessage", action = "urn:greetWithMessage")
    String greetWithMessage(@WebParam(name = "message") String message, @WebParam(name = "name") String name);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">// Service implementation
@WebService(serviceName="greeting", endpointInterface = "org.wildfly.camel.examples.jaxws.GreetingService")
public class GreetingServiceImpl {
    @Produce(uri="direct:start")
    GreetingService greetingService;

    @WebMethod(operationName = "greet")
    public String greet(@WebParam(name = "name") String name) {
        return greetingService.greet(name);
    }

    @WebMethod(operationName = "greetWithMessage")
    public String greetWithMessage(@WebParam(name = "message") String message, @WebParam(name = "name") String name) {
        return greetingService.greetWithMessage(message, name);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice in the above code example that <code>GreetingServiceImpl</code> delegates all method calls to a greetingService object which has been annotated
with <code>@Produce</code>. This annotation is important as it configures a proxy for the <code>direct:start</code> endpoint against the <code>GreetingService</code> interface. Whenever any of the web service methods are invoked by clients, the <code>direct:start</code> camel route is triggered.</p>
</div>
<div class="paragraph">
<p>The RouteBuilder class implements logic for each web service method invocation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Startup
@ApplicationScoped
@ContextName("jaxws-camel-context")
public class JaxwsRouteBuilder extends RouteBuilder {
    @Override
    public void configure() throws Exception {
        from("direct:start")
        .process(new Processor() {
            @Override
            public void process(Exchange exchange) throws Exception {
                BeanInvocation beanInvocation = exchange.getIn().getBody(BeanInvocation.class);
                String methodName = beanInvocation.getMethod().getName();

                if(methodName.equals("greet")) {
                    String name = exchange.getIn().getBody(String.class);
                    exchange.getOut().setBody("Hello " + name);
                } else if(methodName.equals("greetWithMessage")) {
                    String message = (String) beanInvocation.getArgs()[0];
                    String name = (String) beanInvocation.getArgs()[1];
                    exchange.getOut().setBody(message + " " + name);
                } else {
                    throw new IllegalStateException("Unknown method invocation " + methodName);
                }
            }
        });
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above RouteBuilder a <code>Processor</code> handles web service method invocations that have been proxied through the <code>direct:start</code> endpoint.
The exchange message body will be an instance of <code>BeanInvocation</code>. This can be used to determine which web service method was invoked and
what arguments were passed to it. In this example some simple logic is used to return results to the client based on the name of the method that
was called.</p>
</div>
</div>
<div class="sect3">
<h4 id="_security_2">5.5.4. Security</h4>
<div class="paragraph">
<p>Refer to the <a href="index.html#_jax_ws_security">JAX-WS security section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_examples_on_github_2">5.5.5. Code examples on GitHub</h4>
<div class="paragraph">
<p>Example JAX-WS applications are available on GitHub.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/wildfly-extras/wildfly-camel-examples/tree/master/camel-cxf-jaxws" target="_blank">Camel CXF application</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jms">5.6. JMS</h3>
<div class="paragraph">
<p>Messaging support is provided through the <a href="http://camel.apache.org/jms.html" target="_blank">camel-jms</a>
component which integrates with the WildFly Messaging (<a href="https://activemq.apache.org/artemis/)" target="_blank">ActiveMQ Artemis</a>) subsystem.</p>
</div>
<div class="paragraph">
<p>Integration with other JMS implementations is possible through configuration of vendor specific resource adapters, or if not available, by using the JBoss Generic JMS resource adapter.</p>
</div>
<div class="sect3">
<h4 id="_wildfly_jms_configuration">5.6.1. WildFly JMS configuration</h4>
<div class="paragraph">
<p>The WildFly <a href="https://docs.jboss.org/author/display/WFLY8/Messaging+configuration" target="_blank">messaging subsystem</a> can be configured from within the standard WildFly XML configuration files, standalone.xml or domain.xml.</p>
</div>
<div class="paragraph">
<p>For the examples that follow we use the embedded ActiveMQ Artemis in memory instance. We first configure a new JMS queue on the messaging subsystem by adding the following XML configuration to the jms-destinations section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;jms-queue name="WildFlyCamelQueue"&gt;
  &lt;entry name="java:/jms/queue/WildFlyCamelQueue"/&gt;
&lt;/jms-queue&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you could use a CLI script to add the queue.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ jms-queue add --queue-address=WildFlyCamelQueue --entries=queue/WildFlyCamelQueue,java:/jms/queue/WildFlyCamelQueue</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, you could create a <code>messaging-deployment</code> configuration within a custom jms.xml deployment descriptor. See section 'Deployment of -jms.xml files' within the WildFly messaging subsystem documentation for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="_camel_route_configuration_2">5.6.2. Camel route configuration</h4>
<div class="paragraph">
<p>The following JMS producer and consumer examples make use of WildFly&#8217;s embedded ActiveMQ Artemis sever to publish and consume messages to and from destinations.</p>
</div>
<div class="paragraph">
<p>The examples also use CDI in conjunction with the camel-cdi component. JMS ConnectionFactory instances are injected into the Camel RouteBuilder through JNDI lookups.</p>
</div>
<div class="sect4">
<h5 id="_jms_producer">JMS Producer</h5>
<div class="paragraph">
<p>The RouteBuilder begins by injecting the <code>DefaultJMSConnectionFactory</code> connection factory from JNDI. If you&#8217;re wondering where the connection factory is defined, look at the WildFly XML configuration and you&#8217;ll see it is defined within the messaging subsystem.</p>
</div>
<div class="paragraph">
<p>Next a timer endpoint runs every 10 seconds to send an XML payload to the WildFlyCamelQueue destination that we configured earlier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Startup
@ApplicationScoped
@ContextName("jms-camel-context")
public class JmsRouteBuilder extends RouteBuilder {

  @Resource(mappedName = "java:jboss/DefaultJMSConnectionFactory")
  private ConnectionFactory connectionFactory;

  @Override
  public void configure() throws Exception {
    JmsComponent component = new JmsComponent();
    component.setConnectionFactory(connectionFactory);

    getContext().addComponent("jms", component);

    from("timer://sendJMSMessage?fixedRate=true&amp;period=10000")
    .transform(constant("&lt;?xml version='1.0&gt;&lt;message&gt;&lt;greeting&gt;hello world&lt;/greeting&gt;&lt;/message&gt;"))
    .to("jms:queue:WildFlyCamelQueue")
    .log("JMS Message sent");
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A log message will be output to the console each time a JMS message is added to the WildFlyCamelQueue destination. To verify that the messages really are being placed onto the queue, we can use the WildFly administration console.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/jms-queue-browse.png" alt="jms queue browse">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_jms_consumer">JMS Consumer</h5>
<div class="paragraph">
<p>To consume JMS messages the Camel RouteBuilder implementation is similar to the producer example.</p>
</div>
<div class="paragraph">
<p>As before, the connection factory is discovered from JNDI, injected and set on the JMSComponent instance.</p>
</div>
<div class="paragraph">
<p>When the JMS endpoint consumes messages from the WildFlyCamelQueue destination, the content is logged to the console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Override
public void configure() throws Exception {
  JmsComponent component = new JmsComponent();
  component.setConnectionFactory(connectionFactory);

  getContext().addComponent("jms", component);

  from("jms:queue:WildFlyCamelQueue")
  .to("log:jms?showAll=true");
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_jms_transactions">JMS Transactions</h5>
<div class="paragraph">
<p>To enable Camel JMS routes to participate in JMS transactions, some additional configuration is required. Since camel-jms is built around spring-jms, we need to configure some Spring classes to enable them to work with WildFly&#8217;s transaction manager and connection factory. The following code example demonstrates how to use CDI to configure a transactional JMS Camel route.</p>
</div>
<div class="paragraph">
<p>The camel-jms component requires a transaction manager of type <code>org.springframework.transaction.PlatformTransactionManager</code>. Therefore, we begin by creating a bean extending <code>JtaTransactionManager</code>. Note that the bean is annotated with <code>@Named</code> to allow the bean to be registered within the Camel bean registry. Also note that the WildFly transaction manager and user transaction instances are injected using CDI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Named("transactionManager")
public class CdiTransactionManager extends JtaTransactionManager {

  @Resource(mappedName = "java:/TransactionManager")
  private TransactionManager transactionManager;

  @Resource
  private UserTransaction userTransaction;

  @PostConstruct
  public void initTransactionManager() {
    setTransactionManager(transactionManager);
    setUserTransaction(userTransaction);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next we need to declare the transaction policy that we want to use. Again we use the <code>@Named</code> annotation to make the bean available to Camel. The transaction manager is also injected so that a TransactionTemplate can be created with the desired transaction policy. PROPAGATION_REQUIRED in this instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Named("PROPAGATION_REQUIRED")
public class CdiRequiredPolicy extends SpringTransactionPolicy {
  @Inject
  public CdiRequiredPolicy(CdiTransactionManager cdiTransactionManager) {
    super(new TransactionTemplate(cdiTransactionManager,
      new DefaultTransactionDefinition(TransactionDefinition.PROPAGATION_REQUIRED)));
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can configure our Camel RouteBuilder class and inject the dependencies needed for the Camel JMS component. The WildFly XA connection factory is injected together with the transaction manager we configured earlier.</p>
</div>
<div class="paragraph">
<p>In this example RouteBuilder, whenever any messages are consumed from queue1, they are routed to another JMS queue named queue2. Messages consumed from queue2 result in JMS transaction being rolled back using the rollback() DSL method. This results in the original message being placed onto the dead letter queue(DLQ).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Startup
@ApplicationScoped
@ContextName("jms-camel-context")
public class JMSRouteBuilder extends RouteBuilder {

  @Resource(mappedName = "java:/JmsXA")
  private ConnectionFactory connectionFactory;

  @Inject
  CdiTransactionManager transactionManager;

  @Override
  public void configure() throws Exception {
    // Creates a JMS component which supports transactions
    JmsComponent jmsComponent = JmsComponent.jmsComponentTransacted(connectionFactory, transactionManager);
    getContext().addComponent("jms", jmsComponent);

    from("jms:queue:queue1")
      .transacted("PROPAGATION_REQUIRED")
      .to("jms:queue:queue2");

    // Force the transaction to roll back. The message will end up on the WildFly 'DLQ' message queue
    from("jms:queue:queue2")
      .to("log:end")
      .rollback();
  }</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_remote_jms_destinations">Remote JMS destinations</h5>
<div class="paragraph">
<p>It&#8217;s possible for one WildFly instance to send messages to ActiveMQ Artemis destinations configured on another WildFly instance through <a href="https://docs.jboss.org/author/display/WFLY8/Remote+JNDI+Reference" target="_blank">remote JNDI</a>.</p>
</div>
<div class="paragraph">
<p>Some additional WildFly configuration is required to achieve this. First an exported JMS queue is configured.</p>
</div>
<div class="paragraph">
<p>Only JNDI names bound in the <code>java:jboss/exported</code> namespace are considered as candidates for remote clients, so the queue is named appropriately.</p>
</div>
<div class="paragraph">
<p>Note that the queue must be configured on the WildFly client application server <em>and</em> the WildFly remote server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;jms-queue name="RemoteQueue"&gt;
  &lt;entry name="java:jboss/exported/jms/queues/RemoteQueue"/&gt;
&lt;/jms-queue&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before the client can connect to the remote server, user access credentials need to be configured. On the remote server run the <a href="https://docs.jboss.org/author/display/WFLY8/add-user+utility" target="_blank">add user utility</a> to create a new application user within the 'guest' group. This example has a user with the name 'admin' and a password of 'secret'.</p>
</div>
<div class="paragraph">
<p>The RouteBuilder implementation is different to the previous examples. Instead of injecting the connection factory, we need to configure an InitalContext and retrieve it from JNDI ourselves.</p>
</div>
<div class="paragraph">
<p>The <code>configureInitialContext</code> method creates this InitialContext. Notice that we need to set a provider URL which should reference your remote WildFly instance host name and port number. This example uses the WildFly JMS http-connector, but there are alternatives documented <a href="https://docs.jboss.org/author/display/WFLY8/Messaging+configuration" target="_blank">here</a>.</p>
</div>
<div class="paragraph">
<p>Finally the route is configured to send an XML payload every 10 seconds to the remote destination configured earlier - 'RemoteQueue'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Override
public void configure() throws Exception {
  Context initialContext = configureInitialContext();
  ConnectionFactory connectionFactory = (ConnectionFactory) initialContext.lookup("java:jms/RemoteConnectionFactory");

  JmsComponent component = new JmsComponent();
  component.setConnectionFactory(connectionFactory);

  getContext().addComponent("jms", component);

  from("timer://foo?fixedRate=true&amp;period=10000")
  .transform(constant("&lt;?xml version='1.0&gt;&lt;message&gt;&lt;greeting&gt;hello world&lt;/greeting&gt;&lt;/message&gt;"))
  .to("jms:queue:RemoteQueue?username=admin&amp;password=secret")
  .to("log:jms?showAll=true");
}

private Context configureInitialContext() throws NamingException {
  final Properties env = new Properties();
  env.put(Context.INITIAL_CONTEXT_FACTORY, "org.jboss.naming.remote.client.InitialContextFactory");
  env.put(Context.PROVIDER_URL, System.getProperty(Context.PROVIDER_URL, "http-remoting://my-remote-host:8080"));
  env.put(Context.SECURITY_PRINCIPAL, System.getProperty("username", "admin"));
  env.put(Context.SECURITY_CREDENTIALS, System.getProperty("password", "secret"));
  return new InitialContext(env);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_security_3">5.6.3. Security</h4>
<div class="paragraph">
<p>Refer to the <a href="index.html#_jms_security">JMS security section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_examples_on_github_3">5.6.4. Code examples on GitHub</h4>
<div class="paragraph">
<p>An example <a href="https://github.com/wildfly-extras/wildfly-camel-examples/tree/master/camel-jms" target="_blank">camel-jms application</a> is available on GitHub.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jmx">5.7. JMX</h3>
<div class="paragraph">
<p>Management support is provided through the <a href="http://camel.apache.org/jmx.html" target="_blank">camel-jmx</a> component which integrates with the WildFly JMX subsystem.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = contextFactory.createWildflyCamelContext(getClass().getClassLoader());
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        String host = InetAddress.getLocalHost().getHostName();
        from("jmx:platform?format=raw&amp;objectDomain=org.apache.camel&amp;key.context=" + host + "/system-context-1&amp;key.type=routes&amp;key.name=\"route1\"" +
        "&amp;monitorType=counter&amp;observedAttribute=ExchangesTotal&amp;granularityPeriod=500").
        to("direct:end");
    }
});
camelctx.start();

ConsumerTemplate consumer = camelctx.createConsumerTemplate();
MonitorNotification notifcation = consumer.receiveBody("direct:end", MonitorNotification.class);
Assert.assertEquals("ExchangesTotal", notifcation.getObservedAttribute());</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jndi">5.8. JNDI</h3>
<div class="paragraph">
<p>JNDI integration is provided by a WildFly specific CamelContext, which is can be obtained like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">InitialContext inictx = new InitialContext();
CamelContextFactory factory = inictx.lookup("java:jboss/camel/CamelContextFactory");
WildFlyCamelContext camelctx = factory.createCamelContext();</code></pre>
</div>
</div>
<div class="paragraph">
<p>From a <code>WildFlyCamelContext</code> you can obtain a preconfigured Naming Context</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">Context context = camelctx.getNamingContext();
context.bind("helloBean", new HelloBean());</code></pre>
</div>
</div>
<div class="paragraph">
<p>which can then be referenced from Camel routes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:start").beanRef("helloBean");
    }
});
camelctx.start();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jpa">5.9. JPA</h3>
<div class="paragraph">
<p>JPA integration is provided by the <a href="http://camel.apache.org/jpa.html" target="_blank">Camel JPA component</a>.
Camel JPA applications are developed as per normal by providing a persistence.xml configuration file together with some JPA annotated classes.</p>
</div>
<div class="sect3">
<h4 id="_example_persistence_xml">5.9.1. Example persistence.xml</h4>
<div class="paragraph">
<p>In this example we use the Wildfly in-memory ExampleDS datasource which is configured within the Wildfly standalone.xml configuration file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;persistence version="2.0"
    xmlns="http://java.sun.com/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://java.sun.com/xml/ns/persistence http://java.sun.com/xml/ns/persistence/persistence_2_0.xsd"&gt;

    &lt;persistence-unit name="camel"&gt;
        &lt;jta-data-source&gt;java:jboss/datasources/ExampleDS&lt;/jta-data-source&gt;
        &lt;class&gt;org.wildfly.camel.test.jpa.model.Customer&lt;/class&gt;
        &lt;properties&gt;
            &lt;property name="hibernate.hbm2ddl.auto" value="create-drop"/&gt;
            &lt;property name="hibernate.show_sql" value="true"/&gt;
        &lt;/properties&gt;
    &lt;/persistence-unit&gt;

&lt;/persistence&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_jpa_entitiy">5.9.2. Example JPA entitiy</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Entity
@Table(name = "customer")
public class Customer implements Serializable {
    @Id
    @GeneratedValue
    private Long id;
    private String firstName;
    private String lastName;

    public Customer() {
    }

    public Customer(String firstName, String lastName) {
        this.firstName = firstName;
        this.lastName = lastName;
    }

    public Long getId() {
        return id;
    }

    public void setId(final Long id) {
        this.id = id;
    }

    public String getFirstName() {
        return firstName;
    }

    public void setFirstName(String firstName) {
        this.firstName = firstName;
    }

    public String getLastName() {
        return lastName;
    }

    public void setLastName(String lastName) {
        this.lastName = lastName;
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_camel_jpa_endpoint_route_configuration">5.9.3. Camel JPA endpoint / route configuration</h4>
<div class="paragraph">
<p>Having configured JPA, you can make use of CDI to inject an EntityManager and UserTransaction instance into your RouteBuilder class or test case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@PersistenceContext
EntityManager em;

@Inject
UserTransaction userTransaction;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now to configure the Camel routes and JPA endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">WildFlyCamelContext camelctx = contextFactory.createCamelContext(getClass().getClassLoader());

EntityManagerFactory entityManagerFactory = em.getEntityManagerFactory();

// Configure a transaction manager
JtaTransactionManager transactionManager = new JtaTransactionManager();
transactionManager.setUserTransaction(userTransaction);
transactionManager.afterPropertiesSet();

// Configure the JPA endpoint to use the correct EntityManagerFactory and JtaTransactionManager
final JpaEndpoint jpaEndpoint = new JpaEndpoint();
jpaEndpoint.setCamelContext(camelctx);
jpaEndpoint.setEntityType(Customer.class);
jpaEndpoint.setEntityManagerFactory(entityManagerFactory);
jpaEndpoint.setTransactionManager(transactionManager);

camelctx.addRoutes(new RouteBuilder() {
@Override
public void configure() throws Exception {
    from("direct:start")
    .to(jpaEndpoint);
}
});

camelctx.start();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we can send a 'Customer' entity to the 'direct:start' endpoint and then query the ExampleDS datasource to verify that a record was saved.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">Customer customer = new Customer("John", "Doe");
ProducerTemplate producer = camelctx.createProducerTemplate();
producer.sendBody("direct:start", customer);

// Query the in memory database customer table to verify that a record was saved
CriteriaBuilder criteriaBuilder = em.getCriteriaBuilder();
CriteriaQuery&lt;Long&gt; query = criteriaBuilder.createQuery(Long.class);
query.select(criteriaBuilder.count(query.from(Customer.class)));

long recordCount = em.createQuery(query).getSingleResult();

Assert.assertEquals(1L, recordCount);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_camel_components">6. Camel Components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter details information about supported camel components</p>
</div>
<div class="sect2">
<h3 id="_camel_activemq">6.1. camel-activemq</h3>
<div class="paragraph">
<p>Camel ActiveMQ integration is provided by the <a href="http://camel.apache.org/activemq.html" target="_blank">camel-activemq</a> component.</p>
</div>
<div class="paragraph">
<p>The component can be configured to work with an embedded or external broker. For Wildfly / EAP container managed connection pools and XA-Transaction support, the <a href="http://activemq.apache.org/resource-adapter.html" target="_blank">ActiveMQ Resource Adapter</a> can be configured into the container configuration file.</p>
</div>
<div class="sect3">
<h4 id="_wildfly_activemq_resource_adapter_configuration">6.1.1. WildFly ActiveMQ resource adapter configuration</h4>
<div class="paragraph">
<p>Dowonload the <a href="https://repository.apache.org/content/repositories/releases/org/apache/activemq/activemq-rar/5.11.1/activemq-rar-5.11.1.rar" target="_blank">ActiveMQ resource adapter rar file</a>. The following steps outline how to configure the ActiveMQ resource adapter.</p>
</div>
<div class="paragraph">
<p><em>1)</em> Make sure your WildFly instance is stopped.</p>
</div>
<div class="paragraph">
<p><em>2)</em> Copy the downloaded resource adapter to the relevant WildFly deployment directory. For standalone mode:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cp activemq-rar-5.11.1.rar ${JBOSS_HOME}/standalone/deployments/activemq-rar.rar</pre>
</div>
</div>
<div class="paragraph">
<p><em>3)</em> Configure the WildFly resource adapters subsystem for the ActiveMQ adapter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:resource-adapters:2.0"&gt;
     &lt;resource-adapters&gt;
         &lt;resource-adapter id="activemq-rar.rar"&gt;
             &lt;archive&gt;
                 activemq-rar.rar
             &lt;/archive&gt;
             &lt;transaction-support&gt;XATransaction&lt;/transaction-support&gt;
             &lt;config-property name="UseInboundSession"&gt;
                 false
             &lt;/config-property&gt;
             &lt;config-property name="Password"&gt;
                 defaultPassword
             &lt;/config-property&gt;
             &lt;config-property name="UserName"&gt;
                 defaultUser
             &lt;/config-property&gt;
             &lt;config-property name="ServerUrl"&gt;
                 tcp://localhost:61616?jms.rmIdFromConnectionId=true
             &lt;/config-property&gt;
             &lt;connection-definitions&gt;
                 &lt;connection-definition class-name="org.apache.activemq.ra.ActiveMQManagedConnectionFactory" jndi-name="java:/ActiveMQConnectionFactory" enabled="true" pool-name="ConnectionFactory"&gt;
                     &lt;xa-pool&gt;
                         &lt;min-pool-size&gt;1&lt;/min-pool-size&gt;
                         &lt;max-pool-size&gt;20&lt;/max-pool-size&gt;
                         &lt;prefill&gt;false&lt;/prefill&gt;
                         &lt;is-same-rm-override&gt;false&lt;/is-same-rm-override&gt;
                     &lt;/xa-pool&gt;
                 &lt;/connection-definition&gt;
             &lt;/connection-definitions&gt;
             &lt;admin-objects&gt;
                 &lt;admin-object class-name="org.apache.activemq.command.ActiveMQQueue" jndi-name="java:/queue/HELLOWORLDMDBQueue" use-java-context="true" pool-name="HELLOWORLDMDBQueue"&gt;
                     &lt;config-property name="PhysicalName"&gt;
                         HELLOWORLDMDBQueue
                     &lt;/config-property&gt;
                 &lt;/admin-object&gt;
                 &lt;admin-object class-name="org.apache.activemq.command.ActiveMQTopic" jndi-name="java:/topic/HELLOWORLDMDBTopic" use-java-context="true" pool-name="HELLOWORLDMDBTopic"&gt;
                     &lt;config-property name="PhysicalName"&gt;
                         HELLOWORLDMDBTopic
                     &lt;/config-property&gt;
                 &lt;/admin-object&gt;
             &lt;/admin-objects&gt;
         &lt;/resource-adapter&gt;
     &lt;/resource-adapters&gt;
 &lt;/subsystem&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your resource adapter archive filename differs from activemq-rar.rar, you must change the content of the archive element in the preceding configuration to match the name of your archive file.</p>
</div>
<div class="paragraph">
<p>The values of the UserName and Password configuration properties must be chosen to match the credentials of a valid user in the external broker.</p>
</div>
<div class="paragraph">
<p>You might need to change the value of the ServerUrl configuration property to match the actual hostname and port exposed by the external broker.</p>
</div>
<div class="paragraph">
<p><em>4)</em> Start WildFly. If everything is configured correctly, you should see a message within the WildFly server.log like.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>13:16:08,412 INFO  [org.jboss.as.connector.deployment] (MSC service thread 1-5) JBAS010406: Registered connection factory java:/AMQConnectionFactory`</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_camel_route_configuration_3">6.1.2. Camel route configuration</h4>
<div class="paragraph">
<p>The following ActiveMQ producer and consumer examples make use of the ActiveMQ embedded broker and the 'vm' transport (thus avoiding the need for an external ActiveMQ broker).</p>
</div>
<div class="paragraph">
<p>The examples use CDI in conjunction with the camel-cdi component. JMS ConnectionFactory instances are injected into the Camel RouteBuilder through JNDI lookups.</p>
</div>
<div class="sect4">
<h5 id="_activemq_producer">ActiveMQ Producer</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Startup
@ApplicationScoped
@ContextName("activemq-camel-context")
public class ActiveMQRouteBuilder extends RouteBuilder {

  @Override
  public void configure() throws Exception {
    from("timer://sendJMSMessage?fixedRate=true&amp;period=10000")
    .transform(constant("&lt;?xml version='1.0&gt;&lt;message&gt;&lt;greeting&gt;hello world&lt;/greeting&gt;&lt;/message&gt;"))
    .to("activemq:queue:WildFlyCamelQueue?brokerURL=vm://localhost")
    .log("JMS Message sent");
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A log message will be output to the console each time a message is added to the WildFlyCamelQueue destination. To verify that the messages really are being placed onto the queue, we can use the ../features/hawtio.md[Hawtio console,window=_blank] provided by the WildFly Camel subsystem.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/activemq-queue-browse.png" alt="activemq queue browse">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_activemq_consumer">ActiveMQ Consumer</h5>
<div class="paragraph">
<p>To consume ActiveMQ messages the Camel RouteBuilder implementation is similar to the producer example.</p>
</div>
<div class="paragraph">
<p>When the ActiveMQ endpoint consumes messages from the WildFlyCamelQueue destination, the content is logged to the console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Override
public void configure() throws Exception {
  from("activemq:queue:WildFlyCamelQueue?brokerURL=vm://localhost")
  .to("log:jms?showAll=true");
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_activemq_transactions">ActiveMQ Transactions</h5>
<div class="sect5">
<h6 id="_activemq_resource_adapter_configuration">ActiveMQ Resource Adapter Configuration</h6>
<div class="paragraph">
<p>The ActiveMQ resource adapter is required as we will want to leverage XA transaction support, connection pooling etc.</p>
</div>
<div class="paragraph">
<p>The XML snippet below shows how the resource adapter is configured within the WildFly server XML configuration. Notice that the <code>ServerURL</code> is set to use an embedded broker. The connection factory is bound to the JNDI name <code>java:/ActiveMQConnectionFactory</code>. This will be looked up in the RouteBuilder example that follows.</p>
</div>
<div class="paragraph">
<p>Finally, two queues are configured named 'queue1' and 'queue2'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:resource-adapters:2.0"&gt;
  &lt;resource-adapters&gt;
    &lt;resource-adapter id="activemq-rar.rar"&gt;
      ...
      &lt;admin-objects&gt;
        &lt;admin-object class-name="org.apache.activemq.command.ActiveMQQueue" jndi-name="java:/queue/queue1" use-java-context="true" pool-name="queue1pool"&gt;
          &lt;config-property name="PhysicalName"&gt;queue1&lt;/config-property&gt;
        &lt;/admin-object&gt;
        &lt;admin-object class-name="org.apache.activemq.command.ActiveMQQueue" jndi-name="java:/queue/queue2" use-java-context="true" pool-name="queue2pool"&gt;
          &lt;config-property name="PhysicalName"&gt;queue2&lt;/config-property&gt;
        &lt;/admin-object&gt;
      &lt;/admin-objects&gt;
    &lt;/resource-adapter&gt;
  &lt;/resource-adapters&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_transaction_manager">Transaction Manager</h5>
<div class="paragraph">
<p>The camel-activemq component requires a transaction manager of type <code>org.springframework.transaction.PlatformTransactionManager</code>. Therefore, we begin by creating a bean extending <code>JtaTransactionManager</code> which fulfills this requirement. Note that the bean is annotated with <code>@Named</code> to allow the bean to be registered within the Camel bean registry. Also note that the WildFly transaction manager and user transaction instances are injected using CDI.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Named("transactionManager")
public class CdiTransactionManager extends JtaTransactionManager {

  @Resource(mappedName = "java:/TransactionManager")
  private TransactionManager transactionManager;

  @Resource
  private UserTransaction userTransaction;

  @PostConstruct
  public void initTransactionManager() {
    setTransactionManager(transactionManager);
    setUserTransaction(userTransaction);
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_transaction_policy">Transaction Policy</h5>
<div class="paragraph">
<p>Next we need to declare the transaction policy that we want to use. Again we use the <code>@Named</code> annotation to make the bean available to Camel. The transaction manager is also injected so that a <code>TransactionTemplate</code> can be created with the desired transaction policy. <code>PROPAGATION_REQUIRED</code> in this instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Named("PROPAGATION_REQUIRED")
public class CdiRequiredPolicy extends SpringTransactionPolicy {
  @Inject
  public CdiRequiredPolicy(CdiTransactionManager cdiTransactionManager) {
    super(new TransactionTemplate(cdiTransactionManager,
      new DefaultTransactionDefinition(TransactionDefinition.PROPAGATION_REQUIRED)));
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_route_builder">Route Builder</h5>
<div class="paragraph">
<p>Now we can configure our Camel RouteBuilder class and inject the dependencies needed for the Camel ActiveMQ component. The ActiveMQ connection factory that we configured on the resource adapter configutation is injected together with the transaction manager we configured earlier.</p>
</div>
<div class="paragraph">
<p>In this example RouteBuilder, whenever any messages are consumed from queue1, they are routed to another JMS queue named queue2. Messages consumed from queue2 result in JMS transaction being rolled back using the rollback() DSL method. This results in the original message being placed onto the dead letter queue(DLQ).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@Startup
@ApplicationScoped
@ContextName("activemq-camel-context")
public class ActiveMQRouteBuilder extends RouteBuilder {

  @Resource(mappedName = "java:/ActiveMQConnectionFactory")
  private ConnectionFactory connectionFactory;

  @Inject
  private CdiTransactionManager transactionManager;

  @Override
  public void configure() throws Exception {
    ActiveMQComponent activeMQComponent = ActiveMQComponent.activeMQComponent();
    activeMQComponent.setTransacted(false);
    activeMQComponent.setConnectionFactory(connectionFactory);
    activeMQComponent.setTransactionManager(transactionManager);

    getContext().addComponent("activemq", activeMQComponent);

      errorHandler(deadLetterChannel("activemq:queue:ActiveMQ.DLQ")
      .useOriginalMessage()
      .maximumRedeliveries(0)
      .redeliveryDelay(1000));

    from("activemq:queue:queue1F
      .transacted("PROPAGATION_REQUIRED")
      .to("activemq:queue:queue2");

    from("activemq:queue:queue2")
      .to("log:end")
      .rollback();
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_security_4">6.1.3. Security</h4>
<div class="paragraph">
<p>Refer to the <a href="index.html#_jms_security">JMS security section</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_code_examples_on_github_4">6.1.4. Code examples on GitHub</h4>
<div class="paragraph">
<p>An example <a href="https://github.com/wildfly-extras/wildfly-camel-examples/tree/master/camel-activemq" target="_blank">camel-activemq application</a> is available on GitHub.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_atom">6.2. camel-atom</h3>
<div class="paragraph">
<p>Atom feed consumption in Camel is provided by the <a href="http://camel.apache.org/atom.html" target="_blank">camel-atom</a> component.</p>
</div>
<div class="paragraph">
<p>The following example configures an Atom endpoint to consume the recent activity GitHub feed of user 'wildflyext'. The raw content of each feed entry is then written out as a file within directory 'feed/entries'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelContext = new DefaultCamelContext();
camelContext.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("atom://https://github.com/wildflyext.atom?splitEntries=true")
        .process(new Processor() {
            @Override
            public void process(final Exchange exchange) throws Exception {
                Entry entry = exchange.getIn().getBody(Entry.class);
                exchange.getOut().setBody(entry.getContent());
            }
        })
        .to("file:///feed/entries/");
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_bean_validator">6.3. camel-bean-validator</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/bean-validation.html" target="_blank">camel-bean-validator</a>
component provides support for message body validation using the <a href="http://jcp.org/en/jsr/detail?id=303" target="_blank">Java Bean Validation API</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_bindy">6.4. camel-bindy</h3>
<div class="paragraph">
<p>The goal of <a href="http://camel.apache.org/bindy.html" target="_blank">camel-bindy</a> is to allow the parsing/binding of non-structured data to/from Java Beans that have binding mappings defined with annotations.</p>
</div>
<div class="paragraph">
<p>Here we have a annotated domain model class</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@CsvRecord(separator = ",")
public class Customer {

    @DataField(pos = 1)
    private String firstName;

    @DataField(pos = 2)
    private String lastName;

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use the <code>BindyCsvDataFormat</code> data format unmarshall CSV data like <code>John,Doe</code> to the domain model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:start")
        .unmarshal(new BindyCsvDataFormat(Customer.class))
        .to("mock:result");
    }
});
camelctx.start();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_braintree">6.5. camel-braintree</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/braintree.html" target="_blank">camel-braintree</a> component provides access to Braintree Payments trough through their
<a href="https://developers.braintreepayments.com/start/hello-server/java" target="_blank">Java SDK</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">BraintreeComponent component = new BraintreeComponent(camelctx);
component.setConfiguration(configuration);
camelctx.addComponent("braintree", component);

camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("timer://braintree?repeatCount=1")
            .to("braintree:clientToken/generate")
            .process(new Processor() {
                @Override
                public void process(Exchange exchange) throws Exception {
                    latch.countDown();
                }})
            .to("mock:result");
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_cassandra">6.6. camel-cassandra</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/cassandra.html" target="_blank">camel-cassandra</a> component is an open source NoSQL database designed to handle large amounts on commodity hardware. Like Amazon&#8217;s DynamoDB, Cassandra has a peer-to-peer and master-less architecture to avoid single point of failure and garanty high availability. Like Google&#8217;s BigTable, Cassandra data is structured using column families which can be accessed through the Thrift RPC API or a SQL-like API called CQL.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_cdi">6.7. camel-cdi</h3>
<div class="paragraph">
<p>Covered by <a href="index.html#_cdi">CDI</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_crypto">6.8. camel-crypto</h3>
<div class="paragraph">
<p>Secure message exchanges in camel is provided by the <a href="http://camel.apache.org/crypto-digital-signatures.html" target="_blank">camel-crypto</a> component.</p>
</div>
<div class="paragraph">
<p>With Camel cryptographic endpoints and Java&#8217;s Cryptographic extension it is easy to create Digital Signatures for Exchanges. Camel provides a pair of flexible endpoints which get used in concert to create a signature for an exchange in one part of the exchange&#8217;s workflow and then verify the signature in a later part of the workflow.</p>
</div>
<div class="paragraph">
<p>Begin by loading a keystore for binding to JNDI so that camel can discover it from its bean registry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">KeyStore keystore = KeyStore.getInstance(KeyStore.getDefaultType());
InputStream in = getClass().getResourceAsStream("/my-keystore.ks");
keystore.load(in, "my-keystore-password".toCharArray());

Certificate cert = keystore.getCertificate("my-certificate-alias");

KeyStoreParameters keystoreParameters = new KeyStoreParameters();
keystoreParameters.setPassword("my-keystore-password");
keystoreParameters.setResource("./my-keystore.ks");

InitialContext initialContext = new InitialContext();
initialContext.bind("signatureParams", keystoreParameters);
initialContext.bind("keystore", keystore);
initialContext.bind("myPublicKey", cert.getPublicKey());
initialContext.bind("myCert", cert);
initialContext.bind("myPrivateKey", keystore.getKey("my-certificate-alias", "my-keystore-password".toCharArray()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, a Camel route that signs and verifies an exchange.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelContext = new DefaultCamelContext();
camelContext.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
      from("direct:sign")
      .to("crypto:sign://basic?privateKey=#myPrivateKey")
      .to("direct:verify");</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>      from("direct:verify")
      .to("crypto:verify://basic?publicKey=#myPublicKey")
      .to("mock:result");
    }
});</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_cxf">6.9. camel-cxf</h3>
<div class="paragraph">
<p>Covered by <a href="index.html#_jax_rs">JAX-RS</a> and <a href="index.html#_jax_ws">JAX-WS</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_dns">6.10. camel-dns</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/dns.html" target="_blank">camel-dns</a> component provides the ability to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resolve a domain by its ip</p>
</li>
<li>
<p>Lookup information about a domain</p>
</li>
<li>
<p>Run DNS queries</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">  CamelContext camelctx = new DefaultCamelContext();
  camelctx.addRoutes(new RouteBuilder() {
      @Override
      public void configure() throws Exception {
          from("direct:start")
          .to("dns:lookup");
      }
  });

  ProducerTemplate producer = camelctx.createProducerTemplate();
  Record[] record = producer.requestBodyAndHeader("direct:start", null, DnsConstants.DNS_NAME, "wildfly.org", Record[].class);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_dozer">6.11. camel-dozer</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/dozer.html" target="_blank">camel-dozer</a>
component provides the ability to map between Java beans using the <a href="http://camel.apache.org/dozer-type-conversion.html" target="_blank">Dozer</a>
mapping framework.  Camel also supports the ability to trigger Dozer mappings as a <a href="http://camel.apache.org/dozer-type-conversion.html" target="_blank">type converter</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:start").convertBodyTo(CustomerB.class);
    }
});

DozerBeanMapperConfiguration mconfig = new DozerBeanMapperConfiguration();
mconfig.setMappingFiles(Arrays.asList(new String[] { "mappings.xml" }));
new DozerTypeConverterLoader(camelctx, mconfig);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_ejb">6.12. camel-ejb</h3>
<div class="paragraph">
<p>Covered by <a href="index.html#_ejb">EJB</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_elasticsearch">6.13. camel-elasticsearch</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/elasticsearch.html" target="_blank">camel-elasticsearch</a>
component allows you to interface with an <a href="https://www.elastic.co/" target="_blank">ElasticSearch</a> server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">   CamelContext camelContext = new DefaultCamelContext();
   camelContext.addRoutes(new RouteBuilder() {
       @Override
       public void configure() throws Exception {
           from("direct:index")
           .to("elasticsearch://local?operation=INDEX&amp;indexName=twitter&amp;indexType=tweet");
       }
   });

   Map&lt;String, String&gt; indexedData = new HashMap&lt;&gt;();
   indexedData.put("content", "test");

   ProducerTemplate template = camelContext.createProducerTemplate();
   template.sendBody("direct:index", indexedData);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_file2">6.14. camel-file2</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/file2.html" target="_blank">camel-file</a> component provides access to file systems, allowing files to be processed by any other Camel Components or messages from other components to be saved to disk.</p>
</div>
<div class="paragraph">
<p>Here is a simple route that prepends the message with 'Hello' and writes the result to a file in WildFly&#8217;s data directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">final String datadir = System.getProperty("jboss.server.data.dir");

CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:start").transform(body().prepend("Hello ")).
        to("file:" + datadir + "?fileName=camel-file.txt");
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_ftp">6.15. camel-ftp</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/ftp2.html" target="_blank">camel-ftp</a> component provides access to remote file systems over the FTP and SFTP protocols.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
Endpoint endpoint = camelctx.getEndpoint("ftp://localhost:21000/foo?username=admin&amp;password=admin");
camelctx.createProducerTemplate().sendBodyAndHeader(endpoint, "Hello", "CamelFileName", "test.txt");</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_hl7">6.16. camel-hl7</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/hl7.html" target="_blank">camel-hl7</a>
component is used for working with the HL7 MLLP protocol and <a href="http://www.hl7.org/implement/standards/product_brief.cfm?product_id=185" target="_blank">HL7 v2</a>
messages using the <a href="http://hl7api.sourceforge.net/" target="_blank">HAPI</a> library.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">final String msg = "MSH|^~\\&amp;|MYSENDER|MYRECEIVER|MYAPPLICATION||200612211200||QRY^A19|1234|P|2.4\r";
final HL7DataFormat format = new HL7DataFormat();

CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:start")
        .marshal(format)
        .unmarshal(format)
        .to("mock:result");
    }
});
camelctx.start();

HapiContext context = new DefaultHapiContext();
Parser p = context.getGenericParser();
Message hapimsg = p.parse(msg);

ProducerTemplate producer = camelctx.createProducerTemplate();
Message result = (Message) producer.requestBody("direct:start", hapimsg);
Assert.assertEquals(hapimsg.toString(), result.toString());</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_http4">6.17. camel-http4</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/http4.html" target="_blank">camel-http</a> component provides HTTP based endpoints for calling external HTTP resources.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:start")
        .to("http4://somehost:8080/simple/myservlet");
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_hystrix">6.18. camel-hystrix</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/hystrix-eip.html" target="_blank">camel-hystrix</a>
EIP provides integration with Netflix <a href="https://github.com/Netflix/Hystrix" target="_blank">Hystrix</a> to be used as circuit breaker in Camel routes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_infinispan">6.19. camel-infinispan</h3>
<div class="paragraph">
<p>This <a href="http://camel.apache.org/infinispan.html" target="_blank">camel-infinispan</a>
component allows you to interact with <a href="http://infinispan.org" target="_blank">Infinispan</a> distributed data grid / caches.</p>
</div>
<div class="paragraph">
<p>You can interact with container managed Infinispan caches by referring to their JNDI lookup within your Camel route. For example, to write a cache entry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">  DefaultCamelContext camelctx = new DefaultCamelContext();
  camelctx.addRoutes(new RouteBuilder() {
      @Override
      public void configure() throws Exception {
          from("direct:put")
          .to("infinispan://localhost?cacheContainer=#java:jboss/infinispan/container/myCache&amp;command=PUT");
      }
  });

  Map&lt;String, Object&gt; headers = new HashMap&lt;&gt;();
  headers.put(InfinispanConstants.KEY, "name");
  headers.put(InfinispanConstants.VALUE, "kermit");

  ProducerTemplate template = camelctx.createProducerTemplate();
  template.sendBodyAndHeaders("direct:put", null, headers);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can interact with external Infinispan caches.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">  DefaultCamelContext camelctx = new DefaultCamelContext();
  camelctx.addRoutes(new RouteBuilder() {
      @Override
      public void configure() throws Exception {
          from("direct:put")
          .to("infinispan://my.cache.host?command=PUT");
      }
  });

  Map&lt;String, Object&gt; headers = new HashMap&lt;&gt;();
  headers.put(InfinispanConstants.KEY, "name");
  headers.put(InfinispanConstants.VALUE, "kermit");

  ProducerTemplate template = camelctx.createProducerTemplate();
  template.sendBodyAndHeaders("direct:put", null, headers);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_irc">6.20. camel-irc</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/irc.html" target="_blank">camel-irc</a> component enables you to publish and consume messages from
<a href="http://en.wikipedia.org/wiki/Internet_Relay_Chat" target="_blank">IRC</a> channels.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_jasypt">6.21. camel-jasypt</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/jasypt.html" target="_blank">camel-jasypt</a> component provides a simplified encryption library which makes encryption and decryption easy. Camel integrates with Jasypt to allow sensitive information in Properties files to be encrypted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">JasyptPropertiesParser jasypt = new JasyptPropertiesParser();
jasypt.setPassword("secret");

PropertiesComponent pc = new PropertiesComponent();
pc.setLocation("classpath:mysecrets.properties");
pc.setPropertiesParser(jasypt);

context.addComponent("properties", pc);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_jaxb">6.22. camel-jaxb</h3>
<div class="paragraph">
<p>Covered by <a href="index.html#_jaxb">JAXB</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_jdbc">6.23. camel-jdbc</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/jdbc.html" target="_blank">camel-jdbc</a> component provides access to SQL databases via JDBC.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_jgroups">6.24. camel-jgroups</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/jgroups.html" target="_blank">camel-jgroups</a>
component provides reliable multicast communication via the <a href="http://www.jgroups.org/" target="_blank">JGroups</a> toolkit.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_jms">6.25. camel-jms</h3>
<div class="paragraph">
<p>Covered by <a href="index.html#_jms">JMS</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_jmx">6.26. camel-jmx</h3>
<div class="paragraph">
<p>Covered by <a href="index.html#_jmx">JMX</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_jpa">6.27. camel-jpa</h3>
<div class="paragraph">
<p>Covered by <a href="index.html#_jpa">JPA</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_jsch">6.28. camel-jsch</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/jsch.html" target="_blank">camel-jsch</a>
component enables secure file transfer using the <a href="http://en.wikipedia.org/wiki/Secure_copy" target="_blank">SCP protocol</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
Endpoint endpoint = camelctx.getEndpoint("scp://localhost:22/my/directory?username=admin&amp;password=admin");
camelctx.createProducerTemplate().sendBodyAndHeader(endpoint, "Hello", "CamelFileName", "test.txt");</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_kafka">6.29. camel-kafka</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/kafka.html" target="_blank">camel-kafka</a>
component is used for communicating with <a href="http://kafka.apache.org/" target="_blank">Apache Kafka</a> message broker.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_ldap">6.30. camel-ldap</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/ldap.html" target="_blank">camel-ldap</a> component provides the capability to perform LDAP queries.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_linkedin">6.31. camel-linkedin</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/linkedin.html" target="_blank">camel-linkedin</a>
component provides access to the <a href="https://developer.linkedin.com/rest" target="_blank">LinkedIn REST APIs</a>.</p>
</div>
<div class="paragraph">
<p>You must have a valid <a href="https://www.linkedin.com/secure/developer" target="_blank">developer account</a> in order to use this component.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_lucene">6.32. camel-lucene</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/lucene.html" target="_blank">camel-lucene</a>
component is based on the <a href="http://lucene.apache.org/" target="_blank">Apache Lucene</a> project. Apache Lucene is a powerful high-performance, full-featured text search engine library written entirely in Java.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_mail">6.33. camel-mail</h3>
<div class="paragraph">
<p>Interaction with email is provided by the <a href="http://camel.apache.org/mail.html" target="_blank">camel-mail</a> component.</p>
</div>
<div class="paragraph">
<p>By default, Camel will create its own mail session and use this to interact with your mail server. Since WildFly already provides a mail subsystem with all of the relevant support for secure connections, username / password encryption etc, it is recommended to configure your mail sessions within the WildFly configuration and use JNDI to wire them into your Camel endpoints.</p>
</div>
<div class="sect3">
<h4 id="_wildfly_configuration">6.33.1. WildFly configuration</h4>
<div class="paragraph">
<p>First we configure the WildFly mail subsystem for our Mail server. This example adds configuration for Google Mail IMAP and SMTP .</p>
</div>
<div class="paragraph">
<p>An additional mail-session is configured after the 'default' session.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;subsystem xmlns="urn:jboss:domain:mail:2.0"&gt;
    &lt;mail-session name="default" jndi-name="java:jboss/mail/Default"&gt;
      &lt;smtp-server outbound-socket-binding-ref="mail-smtp"/&gt;
    &lt;/mail-session&gt;</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    &lt;mail-session debug="true" name="gmail" jndi-name="java:jboss/mail/gmail"&gt;
      &lt;smtp-server outbound-socket-binding-ref="mail-gmail-smtp" ssl="true" username="your-username-here" password="your-password-here"/&gt;
      &lt;imap-server outbound-socket-binding-ref="mail-gmail-imap" ssl="true" username="your-username-here" password="your-password-here"/&gt;
    &lt;/mail-session&gt;
&lt;/subsystem&gt;
Note that we configured `outbound-socket-binding-ref` values of 'mail-gmail-smtp' and 'mail-gmail-imap'. The next step is to configure these socket bindings. Add aditional bindings to the `socket-binding-group` configuration like the following.</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;outbound-socket-binding name="mail-gmail-smtp"&gt;
  &lt;remote-destination host="smtp.gmail.com" port="465"/&gt;
&lt;/outbound-socket-binding&gt;

&lt;outbound-socket-binding name="mail-gmail-imap"&gt;
  &lt;remote-destination host="imap.gmail.com" port="993"/&gt;
&lt;/outbound-socket-binding&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configures our mail session to connect to host smtp.gmail.com on port 465 and imap.gmail.com on port 993. If you&#8217;re using a different mail host, then this detail will be different.</p>
</div>
</div>
<div class="sect3">
<h4 id="_pop3_configuration">6.33.2. POP3 Configuration</h4>
<div class="paragraph">
<p>If you need to configure POP3 sessions, the principals are the same as defined in the examples above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;!-- Server configuration --&gt;
&lt;pop3-server outbound-socket-binding-ref="mail-pop3" ssl="true" username="your-username-here" password="your-password-here"/&gt;

&lt;!-- Socket binding configuration --&gt;
&lt;outbound-socket-binding name="mail-gmail-imap"&gt;
  &lt;remote-destination host="pop3.gmail.com" port="993"/&gt;
&lt;/outbound-socket-binding&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_camel_route_configuration_4">6.33.3. Camel route configuration</h4>
<div class="sect4">
<h5 id="_mail_producer">Mail producer</h5>
<div class="paragraph">
<p>This example uses the SMTPS protocol, together with CDI in conjunction with the camel-cdi component. The Java mail session that we configured within the WildFly configuration is injected into a Camel RouteBuilder through JNDI.</p>
</div>
<div class="sect5">
<h6 id="_route_builder_smtps_example">Route builder SMTPS example</h6>
<div class="paragraph">
<p>The GMail mail session is injected into a Producer class using the <code>@Resource</code> annotation with a reference to the <code>jndi-name</code> attribute that we  previously configured. This allows us to reference the mail session on the camel-mail endpoint configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class MailSessionProducer {
    @Resource(lookup = "java:jboss/mail/greenmail")
    private Session mailSession;

    @Produces
    @Named
    public Session getMailSession() {
        return mailSession;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class MailRouteBuilder extends RouteBuilder {
    @Override
    public void configure() throws Exception {
        from("direct:start")
        .to("smtps://smtp.gmail.com?session=#mailSession");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To send an email we can create a ProducerTemplate and send an appropriate body together with the necessary email headers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">Map&lt;String, Object&gt; headers = new HashMap&lt;String, Object&gt;();
headers.put("To", "destination@test.com");
headers.put("From", "sender@example.com");
headers.put("Subject", "Camel on Wildfly rocks");

String body = "Hi,\n\nCamel on Wildfly rocks!.";

ProducerTemplate template = camelContext.createProducerTemplate();
template.sendBodyAndHeaders("direct:start", body, headers);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_mail_consumer">Mail consumer</h5>
<div class="paragraph">
<p>To receive email we use an IMAP MailEndpoint. The Camel route configuration looks like the following.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public void configure() throws Exception {
   from("imaps://imap.gmail.com?session=#mailSession")
   .to("log:email");
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_security_5">6.33.4. Security</h4>
<div class="sect4">
<h5 id="_ssl_configuration">SSL configuration</h5>
<div class="paragraph">
<p>WildFly can be configured to manage Java mail sessions and their associated transports using SSL / TLS. When configuring mail sessions you can configure SSL or TLS on server types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>smtp-server</p>
</li>
<li>
<p>imap-server</p>
</li>
<li>
<p>pop-server</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By setting attributes <code>ssl="true"</code> or <code>tls="true"</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_securing_passwords">Securing passwords</h5>
<div class="paragraph">
<p>Writing passwords in clear text within configuration files is never a good idea for obvious reasons. The <a href="https://developer.jboss.org/wiki/JBossAS7SecuringPasswords" target="_blank">WildFly Vault</a> provides tooling to mask sensitive data.</p>
</div>
</div>
<div class="sect4">
<h5 id="_camel_security">Camel security</h5>
<div class="paragraph">
<p>Camel endpoint security documentation can be found on the <a href="http://camel.apache.org/mail.html" target="_blank">camel-mail</a>
component guide. Camel also has a <a href="http://camel.apache.org/security.html" target="_blank">security summary</a> page.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_code_examples_on_github_5">6.33.5. Code examples on GitHub</h4>
<div class="paragraph">
<p>An example <a href="https://github.com/wildfly-extras/wildfly-camel-examples/tree/master/camel-mail" target="_blank">camel-mail application</a> is available on GitHub for you to try out sending / receiving email.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_metrics">6.34. camel-metrics</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/metrics-component.html" target="_blank">camel-metrics</a> component allows you to define, publish and collect metrics from Camel routes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">from("direct:start")
.to("metric:counter:simple.counter?increment=3")</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_mina2">6.35. camel-mina2</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/mina2.html" target="_blank">camel-mina2</a>
component is a transport for working with <a href="http://mina.apache.org/" target="_blank">Apache MINA</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_mongodb">6.36. camel-mongodb</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/mongodb.html" target="_blank">camel-mongodb</a>
component provides the capabilty to interact with <a href="http://www.mongodb.org/" target="_blank">MongoDB</a> servers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_mqtt">6.37. camel-mqtt</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/mqtt.html" target="_blank">camel-mqtt</a>
component is used for communicating with <a href="http://mqtt.org/" target="_blank">MQTT</a>
compliant message brokers, like <a href="http://activemq.apache.org/" target="_blank">Apache ActiveMQ</a>
or <a href="http://mosquitto.org/" target="_blank">Mosquitto</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_mvel">6.38. camel-mvel</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/mvel-component.html" target="_blank">camel-mvel</a>
component allows you to process a message using an <a href="https://github.com/mvel/mvel" target="_blank">MVEL</a> template.</p>
</div>
<div class="paragraph">
<p>A simple template</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Hello @{request.body}</pre>
</div>
</div>
<div class="paragraph">
<p>can be used like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:start").to("mvel:template.mvel");
    }
});
camelctx.start();
ProducerTemplate producer = camelctx.createProducerTemplate();
String result = producer.requestBody("direct:start", "Kermit", String.class);
Assert.assertEquals("Hello Kermit", result);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_nats">6.39. camel-nats</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/nats.html" target="_blank">camel-nats</a>
component is used for communicating with the <a href="http://nats.io/" target="_blank">NATS</a> messaging platform.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_netty4">6.40. camel-netty4</h3>
<div class="paragraph">
<p>Netty client / server support in Camel is provided by the <a href="http://camel.apache.org/netty4.html" target="_blank">camel-netty4</a> component.</p>
</div>
<div class="paragraph">
<p>WildFly 8 and EAP 6.4 are bundled with module libraries supporting the <a href="http://netty.io/" target="_blank">Netty</a>
project version 4. Therefore, the standard <a href="http://camel.apache.org/netty.html" target="_blank">camel-netty component</a> will not work since it is compatible with Netty version 3 only.</p>
</div>
<div class="sect3">
<h4 id="_simple_netty_client_server_test">6.40.1. Simple Netty Client / Server Test</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelContext = new DefaultCamelContext();

camelContext.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("netty4:tcp://localhost:7666?textline=true")
                .transform(simple("Hello ${body}"))
                .to("direct:end");
    }
});

camelContext.start();

PollingConsumer pollingConsumer = camelContext.getEndpoint("direct:end").createPollingConsumer();
pollingConsumer.start();

Socket socket = new Socket("localhost", 7666);
PrintWriter out = new PrintWriter(socket.getOutputStream(), true);

try {
    out.write("Kermit\n");
} finally {
    out.close();
    socket.close();
}

String result = pollingConsumer.receive().getIn().getBody(String.class);

Assert.assertEquals("Hello Kermit", result);

camelContext.stop();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_ognl">6.41. camel-ognl</h3>
<div class="paragraph">
<p>OGNL expression support in Camel is provided by the <a href="http://camel.apache.org/ognl.html" target="_blank">camel-ognl</a> component.</p>
</div>
<div class="sect3">
<h4 id="_simple_camel_ognl_use_case">6.41.1. Simple Camel OGNL Use Case</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelContext = new DefaultCamelContext();
camelContext.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:start")
            .choice()
                .when()
                    .ognl("request.body.name == 'Kermit'").transform(simple("Hello ${body.name}"))
                .otherwise()
                    .to("mock:dlq");
    }
});

camelContext.start();

Person person = new Person();
person.setName("Kermit");

ProducerTemplate producer = camelContext.createProducerTemplate();
String result = producer.requestBody("direct:start", person, String.class);

Assert.assertEquals("Hello Kermit", result);

camelContext.stop();</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_olingo2">6.42. camel-olingo2</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/olingo2.html" target="_blank">camel-olingo2</a>
component provides the capability to interact with <a href="http://www.odata.org/" target="_blank">OData</a>
2.0 and 3.0 compliant services via <a href="http://olingo.apache.org/" target="_blank">Apache Olingo</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_pdf">6.43. camel-pdf</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/pdf.html" target="_blank">camel-pdf</a>
component provides the ability to create, modify or extract content from PDF documents. This component uses <a href="https://pdfbox.apache.org/" target="_blank">Apache PDFBox</a> as underlying library to work with PDF documents.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_quartz2">6.44. camel-quartz2</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/quartz2.html" target="_blank">camel-quartz</a>
component provides a scheduled delivery of messages using the <a href="http://www.quartz-scheduler.org" target="_blank">Quartz Scheduler 2.x</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    public void configure() throws Exception {
        from("quartz2://mytimer?trigger.repeatCount=3&amp;trigger.repeatInterval=100")
        .process(new Processor() {
			public void process(Exchange exchange) throws Exception {
				latch.countDown();
			}})
        .to("mock:result");
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_rest">6.45. camel-rest</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/rest.html" target="_blank">camel-rest</a>
component allows you to define REST endpoints using the <a href="http://camel.apache.org/rest-dsl.html" target="_blank">Rest DSL</a> and plugin to other Camel components as the REST transport.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The WildFly Camel Subsystem only supports the camel-servlet and camel-undertow components for use with the REST DSL. Attempts to configure other components will not work.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        restConfiguration().component("servlet").contextPath("camel/rest").port(8080);
        rest("/hello").get("/{name}").to("direct:hello");
        from("direct:hello").transform(simple("Hello ${header.name}"));
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_rss">6.46. camel-rss</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/rss.html" target="_blank">camel-rss</a> component is used for polling RSS feeds.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    public void configure() throws Exception {
        from("rss://https://developer.jboss.org/blogs/feeds/posts?splitEntries=true&amp;consumer.initialDelay=200&amp;consumer.delay=1000")
        .process(new Processor() {
			public void process(Exchange exchange) throws Exception {
				latch.countDown();
			}})
        .to("mock:result");
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_salesforce">6.47. camel-salesforce</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/salesforce.html" target="_blank">camel-salesforce</a>
component provides producer and consumer endpoints to communicate with <a href="http://www.salesforce.com/" target="_blank">Salesforce</a>.</p>
</div>
<div class="paragraph">
<p>In order to use the component, you will need a valid Salesforce account together with credentials for accessing the Salesforce API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client ID</p>
</li>
<li>
<p>Client Secret</p>
</li>
<li>
<p>Password</p>
</li>
<li>
<p>Username</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You&#8217;ll want to generate the necessary Salesforce DTO objects before starting. This can be automated with the <a href="https://github.com/apache/camel/tree/master/components/camel-salesforce/camel-salesforce-maven-plugin" target="_blank">Camel Salesforce Maven plugin</a>.</p>
</div>
<div class="paragraph">
<p>mvn camel-salesforce:generate -DcamelSalesforce.clientId=&lt;clientid&gt; -DcamelSalesforce.clientSecret=&lt;clientsecret&gt; -DcamelSalesforce.userName=&lt;username&gt; -DcamelSalesforce.password=&lt;password&gt;</p>
</div>
<div class="paragraph">
<p>This example queries Salesforce 'Opportunity' objects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">SalesforceLoginConfig loginConfig = new SalesforceLoginConfig();
loginConfig.setClientId("your-client-id");
loginConfig.setPassword("your-password");
loginConfig.setClientSecret("your-client-secret");
loginConfig.setUserName("your-username");

SalesforceComponent component = new SalesforceComponent();
// The package path to the generated DTO classes
component.setPackages("org.wildfly.camel.test.salesforce.dto");
component.setLoginConfig(loginConfig);

CamelContext camelctx = new DefaultCamelContext();
camelctx.addComponent("salesforce",  component);
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:query")
        .to("salesforce:query?sObjectQuery=SELECT id,name from Opportunity&amp;sObjectClass=" + QueryRecordsOpportunity.class.getName())
        .to("log:salesforce?showAll=true");
    }
});

camelctx.start();

ProducerTemplate producer = ctx.createProducerTemplate();
QueryRecordsOpportunity queryRecords = producer.requestBody("direct:query", null, QueryRecordsOpportunity.class);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_sap">6.48. camel-sap</h3>
<div class="paragraph">
<p><a href="https://access.redhat.com/documentation/en-US/Red_Hat_JBoss_Fuse/6.2/html/Apache_Camel_Component_Reference/SAP.html" target="_blank">camel-sap</a> is a package consisting of ten different SAP components.</p>
</div>
<div class="paragraph">
<p>There are remote function call (RFC) components that support the sRFC, tRFC, and qRFC protocols; and there are IDoc components that facilitate communication using messages in IDoc format. The component uses the SAP Java Connector (SAP JCo) library to facilitate bidirectional communication with SAP and the SAP IDoc library to facilitate the transmission of documents in the Intermediate Document (IDoc) format.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A prerequisite for using the Camel SAP component is that the SAP Java Connector (SAP JCo) libraries and the SAP IDoc library are available for the WildFly Camel Subsytem to use. <strong>The subsystem distribution does not include these libraries</strong>. You will need access to the <a href="http://service.sap.com/connectors" target="_blank">SAP Service Marketplace</a> in order to obtain them.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_configuring_the_camel_sap_module">6.48.1. Configuring the camel-sap module</h4>
<div class="paragraph">
<p>Before using camel-sap, an additional WildFly / EAP modules needs to be configured so that the subsystem can discover the new functionality.</p>
</div>
<div class="paragraph">
<p>Your application server should be stopped before making the following changes.</p>
</div>
<div class="sect4">
<h5 id="_modify_module_com_sap_conn_jco">Modify module com.sap.conn.jco</h5>
<div class="paragraph">
<p>Download the SAP JCo libraries and the SAP IDoc library from the <a href="http://service.sap.com/connectors)" target="_blank">SAP Service Marketplace</a>, making sure to choose the appropriate library versions for your operating system.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From a terminal session, change into the application server installation root directory</p>
</li>
<li>
<p>Change into directory <code>modules/system/layers/fuse</code></p>
</li>
<li>
<p>Copy <code>sapjco3.jar</code> and <code>sapidoc3.jar</code> into <code>com/sap/conn/jco/main</code></p>
</li>
<li>
<p>Create an appropriate native library directory within <code>com/sap/conn/jco/main</code>. For example, if your target platform is Linux x86_64 you would create <code>lib/linux-x86_64</code>. For information relating to other operating systems and architectures see the <a href="https://docs.jboss.org/author/display/MODULES/Native+Libraries" target="_blank">WildFly Native Libraries documentation</a></p>
</li>
<li>
<p>Copy the JCO native library (i.e the <code>.so</code>, <code>.dll</code> or <code>.jnilib file</code>) into the native library directory you created in the previous step</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The file and directory structure for module <code>com.sap.conn.jco</code> should now look something like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>com/sap/conn/jco
com/sap/conn/jco/main
com/sap/conn/jco/main/sapidoc3.jar
com/sap/conn/jco/main/sapjco3.jar
com/sap/conn/jco/main/module.xml
com/sap/conn/jco/main/lib
com/sap/conn/jco/main/lib/linux-x86_64
com/sap/conn/jco/main/lib/linux-x86_64/libsapjco3.so</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_activate_camel_sap_component_module">Activate camel-sap component module</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From a terminal session change into the application server installation root directory</p>
</li>
<li>
<p>Change into directory <code>modules/system/layers/fuse/org/wildfly/camel/extras/main</code></p>
</li>
<li>
<p>Edit <code>module.xml</code> and uncomment the <code>org.fusesource.camel.component.sap</code> module dependency. Save the modifed file when finished</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The module definition should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;module xmlns="urn:jboss:module:1.1" name="org.wildfly.camel.extras"&gt;
    &lt;dependencies&gt;
        &lt;module name="org.fusesource.camel.component.sap" export="true" services="export" /&gt;
    &lt;/dependencies&gt;
&lt;/module&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Start your application server and camel-sap will be available for use.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_sap_camel_route">6.48.2. Example SAP Camel Route</h4>
<div class="paragraph">
<p>This example uses XML files containing serialized SAP requests to query Customer records in the Flight Data Application within SAP.</p>
</div>
<div class="paragraph">
<p>These files are consumed by Camel and their contents are then converted to string message bodies. These messages are then routed to an <code>sap-srfc-destination</code> endpoint which converts and sends them to SAP as <code>BAPI_FLCUST_GETLIST</code> requests to query Customer records.</p>
</div>
<div class="paragraph">
<p>First we configure a destination data store.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">DestinationData destinationData = new DestinationDataImpl();
destinationData.setAshost("example.com");
destinationData.setSysnr("00");
destinationData.setClient("000");
destinationData.setUser("user");
destinationData.setPasswd("password");
destinationData.setLang("en");

Map&lt;String, DestinationData&gt; destinationDataStore = new HashMap&lt;&gt;();
destinationDataStore.put("quickstartDest", destinationData);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next wire the destinationDataStore into a SapConnectionConfiguration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">SapConnectionConfiguration configuration = new SapConnectionConfiguration();
configuration.setDestinationDataStore(destinationDataStore);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Camel RouteBuilder looks like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@ApplicationScoped
@ContextName("camel-sap-cdi-context")
@Startup
public class SAPRouteBuilder extends RouteBuilder {
    @Override
    public void configure() throws Exception {
      from("file:src/data")
      .convertBodyTo(String.class)
      .to("log:sap?showAll=true")
      .to("sap-srfc-destination:quickstartDest:BAPI_FLCUST_GETLIST")
      .to("log:sap?showAll=true");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The XML request looks like the following and is consumed from a file within src/data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="ASCII"?&gt;
&lt;!-- NOTE: Replace 'XXX' with the SID of your SAP instance --&gt;
&lt;BAPI_FLCUST_GETLIST:Request xmlns:BAPI_FLCUST_GETLIST="http://sap.fusesource.org/rfc/XXX/BAPI_FLCUST_GETLIST" CUSTOMER_NAME="*" MAX_ROWS="10" WEB_USER="*"/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the Camel route runs, the request XML data is consumed from src/data and sent to SAP as a <code>BAPI_FLCUST_GETLIST</code> request.  The results of the SAP request are output to the console.
You should see an XML structure like the following containing customer records.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;BAPI_FLCUST_GETLIST:Response xmlns:BAPI_FLCUST_GETLIST="http://sap.fusesource.org/rfc/JBF/BAPI_FLCUST_GETLIST"&gt;
&lt;CUSTOMER_LIST&gt;
    &lt;row CUSTOMERID="00004715" CUSTNAME="Fred Flintstone" FORM="Mr." STREET="123 Flintstone Lane" POBOX="" POSTCODE="01234" CITY="Bedrock" COUNTR="US" COUNTR_ISO="US" REGION="" PHONE="800-555-1212" EMAIL=""/&gt;
    &lt;row CUSTOMERID="00004716" CUSTNAME="Wilma Flintstone" FORM="Mr." STREET="123 Flintstone Lane" POBOX="" POSTCODE="01234" CITY="Bedrock" COUNTR="US" COUNTR_ISO="US" REGION="" PHONE="800-555-1212" EMAIL=""/&gt;
&lt;/CUSTOMER_LIST&gt;
&lt;CUSTOMER_RANGE/&gt;
&lt;EXTENSION_IN/&gt;
&lt;EXTENSION_OUT/&gt;
&lt;RETURN&gt;
    &lt;row TYPE="S" ID="BC_IBF" NUMBER="000" MESSAGE="Method was executed successfully" LOG_NO="" LOG_MSG_NO="000000" MESSAGE_V1="" MESSAGE_V2="" MESSAGE_V3="" MESSAGE_V4="" PARAMETER="" FIELD="" SYSTEM="DEVQKCLNT"/&gt;
&lt;/RETURN&gt;
&lt;/BAPI_FLCUST_GETLIST:Response&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_further_reading">6.48.3. Further Reading</h4>
<div class="paragraph">
<p>The example above only scratches the surface of the functionality provided by the camel-sap component. For comprehensive component documentation visit
the <a href="https://access.redhat.com/documentation/en-US/Red_Hat_JBoss_Fuse/6.2/html/Apache_Camel_Component_Reference/SAP.html" target="_blank">Camel SAP Component Reference</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_saxon">6.49. camel-saxon</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/xquery.html" target="_blank">camel-saxon</a>
component supports <a href="http://www.w3.org/TR/xquery/" target="_blank">XQuery</a>
to allow an <a href="http://camel.apache.org/expression.html" target="_blank">Expression</a>
or <a href="http://camel.apache.org/predicate.html" target="_blank">Predicate</a>
to be used in the <a href="http://camel.apache.org/dsl.html" target="_blank">DSL</a>
or <a href="http://camel.apache.org/xml-configuration.html" target="_blank">Xml Configuration</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        Namespaces ns = new Namespaces("ns", "http://org/wildfly/test/jaxb/model/Customer");
        from("direct:start").transform().xquery("/ns:customer/ns:firstName", String.class, ns)
        .to("mock:result");
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_script">6.50. camel-script</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/scripting-languages.html" target="_blank">camel-script</a>
component supports a number of scripting languages which can be used to create an <a href="http://camel.apache.org/expression.html" target="_blank">Expression</a>
or <a href="http://camel.apache.org/predicate.html" target="_blank">Predicate</a>
via the standard <a href="http://jcp.org/en/jsr/detail?id=223" target="_blank">JSR 223</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:start").choice()
        .when(script("beanshell", "request.getHeaders().get(\"foo\").equals(\"bar\")")).to("mock:result")
        .otherwise().transform(body().append(" unmatched")).to("mock:unmatched");
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_servicenow">6.51. camel-servicenow</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/servicenow.html" target="_blank">camel-servicenow</a>
component provides access to the ServiceNow <a href="https://developer.servicenow.com/app.do#!/rest_api_doc?v=fuji" target="_blank">REST APIs</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_servlet">6.52. camel-servlet</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/servlet.html" target="_blank">camel-servlet</a>
component provides HTTP based endpoints for consuming HTTP requests that arrive at a HTTP endpoint that is bound to a published Servlet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("servlet://hello?servletName=CamelServletTest&amp;matchOnUriPrefix=true")
        .process(new Processor() {
            @Override
            public void process(Exchange exchange) throws Exception {
                exchange.getOut().setBody("Hello Kermit");
            }
        });
    }
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_smpp">6.53. camel-smpp</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/smpp.html" target="_blank">camel-smpp</a> component enables SMSC over the SMPP protocol in order to send and receive SMS.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_spring">6.54. camel-spring</h3>
<div class="paragraph">
<p>Camel contexts can be configured with Spring via the <a href="http://camel.apache.org/spring.html" target="_blank">camel-spring</a> component.</p>
</div>
<div class="sect3">
<h4 id="_camel_spring_xml_example">6.54.1. Camel Spring XML example</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd"&gt;

    &lt;camelContext id="hello-camel-context" xmlns="http://camel.apache.org/schema/spring"&gt;
        &lt;route&gt;
            &lt;from uri="timer:hello?period=5000" /&gt;
            &lt;log message="Hello world" /&gt;
        &lt;/route&gt;
    &lt;/camelContext&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_deployment">6.54.2. Deployment</h4>
<div class="paragraph">
<p>Spring Camel contexts can be deployed either as part of the camel subsystem configuration or by deploying a '-camel-context.xml' suffixed file.</p>
</div>
<div class="paragraph">
<p>For more information see the <a href="index.html#_features">features</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_sql">6.55. camel-sql</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/sql-component.html" target="_blank">camel-sql</a>
component allows you to work with databases using <a href="http://camel.apache.org/jdbc.html" target="_blank">JDBC</a> queries. The difference between this component and JDBC component is that in case of SQL the query is a property of the endpoint and it uses message payload as parameters passed to the query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("sql:select name from information_schema.users?dataSource=java:jboss/datasources/ExampleDS")
        .to("direct:end");
    }
});</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The JNDI datasource lookup shown above works only when configuring a <code>DefaultCamelContext</code>. See below for <code>CdiCamelContext</code> and <code>SpringCamelContext</code> examples.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When used in conjunction with the <a href="index.html#_camel_cdi">camel-cdi</a> component, Java EE annotations can make a datasource available to Camel.
This example uses the <code>@Named</code> annotation so that Camel can discover the desired datasource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">public class DatasourceProducer {
    @Resource(name = "java:jboss/datasources/ExampleDS")
    DataSource dataSource;

    @Produces
    @Named("wildFlyExampleDS")
    public DataSource getDataSource() {
        return dataSource;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the datasource can be referenced through the <code>dataSource</code> parameter on the camel-sql endpoint configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">@ApplicationScoped
@ContextName("camel-sql-cdi-context")
@Startup
public class CdiRouteBuilder extends RouteBuilder {
    @Override
    public void configure() throws Exception {
        from("sql:select name from information_schema.users?dataSource=wildFlyExampleDS")
        .to("direct:end");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using <a href="index.html#_camel_spring">camel-spring</a> the route configuration would look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jee="http://www.springframework.org/schema/jee"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd
       http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee.xsd"&gt;

    &lt;jee:jndi-lookup id="wildFlyExampleDS" jndi-name="java:jboss/datasources/ExampleDS"/&gt;

    &lt;camelContext id="sql-spring-context" xmlns="http://camel.apache.org/schema/spring"&gt;
        &lt;route&gt;
            &lt;from uri="sql:select name from information_schema.users?dataSource=#wildFlyExampleDS" /&gt;
            &lt;to uru="direct:end" /&gt;
        &lt;/route&gt;
    &lt;/camelContext&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_spring_jdbc_xml_namespace_support">6.55.1. Spring JDBC XML namespace support</h4>
<div class="paragraph">
<p>Support for the following Spring JDBC XML configurations is supported</p>
</div>
<div class="paragraph">
<p><strong>jdbc:embedded-database</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;jdbc:embedded-database id="datasource" type="H2"&gt;
  &lt;jdbc:script location="db-schema.sql"/&gt;
&lt;/jdbc:embedded-database&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Only H2 databases are supported by default as WildFly has native support for this. If you want to use other embedded database providers, you will need
to install the appropriate database driver.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>jdbc:initialize-database</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;jdbc:initialize-database data-source="datasource"&gt;
  &lt;jdbc:script location="classpath:db-init.sql"/&gt;
&lt;/jdbc:initialize-database&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_stream">6.56. camel-stream</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/stream.html" target="_blank">camel-stream</a> component provides access to the <code>System.in</code>, <code>System.out</code> and <code>System.err</code> streams as well as allowing streaming of file and URL.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_swagger">6.57. camel-swagger</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/swagger-java.html" target="_blank">camel-swagger</a>
module is used for exposing the REST services and their APIs using <a href="http://swagger.io/" target="_blank">Swagger</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        restConfiguration().component("servlet").contextPath("swagger-tests/rest").port(8080);
        rest("/hello").get("/{name}").to("direct:hello");
        from("direct:hello").transform(simple("Hello ${header.name}"));
    }
});
camelctx.start();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_twitter">6.58. camel-twitter</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/twitter.html" target="_blank">camel-twitter</a> component provides the capability to interact with the Twitter API in order
to create and consume tweets, timelines, users, trends, and direct messages.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_undertow">6.59. camel-undertow</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/undertow.html" target="_blank">camel-undertow</a>
component provides HTTP-based endpoints for consuming and producing HTTP requests. That is, the <a href="http://undertow.io/" target="_blank">Undertow</a> component behaves as a simple Web server. Undertow can also be used as a http client which mean you can also use it with Camel as a producer.</p>
</div>
<div class="paragraph">
<p>The Undertow component integrates with the Undertow server provided by WildFly.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_velocity">6.60. camel-velocity</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/velocity.html" target="_blank">camel-velocity</a> component allows you to process a message using an Apache Velocity template.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:start").to("velocity:" + VELOCITY_TEMPLATE);
    }
});
camelctx.start();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_vertx">6.61. camel-vertx</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/vertx.html" target="_blank">camel-vertx</a>
component is for working with the <a href="http://vertx.io/" target="_blank">Vertx</a>
<a href="http://vertx.io/core_manual_js.html#the-event-bus" target="_blank">EventBus</a>. The Vertx EventBus sends and receives JSON events.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_weather">6.62. camel-weather</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/weather.html" target="_blank">camel-weather</a>
component provides integration with the <a href="http://openweathermap.org/api" target="_blank">Open Weather Map API</a>.</p>
</div>
<div class="paragraph">
<p>As an example, we can consume the current weather for Madrid in Spain and make some decisions based upon the humidity percentage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelContext = new DefaultCamelContext();
camelContext.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("weather:foo?location=Madrid,Spain")
        .choice()
          .when().jsonpath("$..[?(@humidity &gt; 90)]")
            .to("direct:veryhumid")
          .when().jsonpath("$..[?(@humidity &gt; 70)]")
            .to("direct:humid")
          .otherwise()
            .to("direct:nothumid");
    }
});
camelContext.start();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_xstream">6.63. camel-xstream</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/xstream.html" target="_blank">camel-xstream</a>
component provides the XStream <a href="http://camel.apache.org/data-format.html" target="_blank">Data Format</a>
which uses the <a href="http://x-stream.github.io/" target="_blank">XStream library</a> to marshal and unmarshal Java objects to and from XML.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:start")
        .marshal().xstream();
    }
});

camelctx.start();
try {
    ProducerTemplate producer = camelctx.createProducerTemplate();
    String customer = producer.requestBody("direct:start", new Customer("John", "Doe"), String.class);
} finally {
    camelctx.stop();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_camel_zipkin">6.64. camel-zipkin</h3>
<div class="paragraph">
<p>The <a href="https://cwiki.apache.org/confluence/display/CAMEL/camel-zipkin" target="_blank">camel-zipkin</a>
component is used for tracing and timing incoming and outgoing Camel messages using <a href="http://zipkin.io/" target="_blank">zipkin</a>. Events are captured for incoming and outgoing messages being sent to/from Camel.</p>
</div>
</div>
<div class="sect2">
<h3 id="_camel_zookeeper">6.65. camel-zookeeper</h3>
<div class="paragraph">
<p>The <a href="http://camel.apache.org/zookeeper.html" target="_blank">camel-zookeeper</a>
component allows interaction with a <a href="http://hadoop.apache.org/zookeeper/" target="_blank">ZooKeeper</a> cluster and exposes the following features to Camel:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creation of nodes in any of the ZooKeeper create modes.</p>
</li>
<li>
<p>Get and Set the data contents of arbitrary cluster nodes.</p>
</li>
<li>
<p>Create and retrieve the list the child nodes.</p>
</li>
<li>
<p>A Distributed RoutePolicy that leverages a Leader election.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_adding_components">6.66. Adding Components</h3>
<div class="paragraph">
<p>Adding support for additional Camel Components is easy</p>
</div>
<h4 id="_add_your_modules_xml_definition" class="discrete">Add your modules.xml definition</h4>
<div class="paragraph">
<p>A modules.xml descriptor defines the class loading behavior for your component. It should be placed together with the component&#8217;s jar in <code>modules/system/layers/fuse/org/apache/camel/component</code>. Module dependencies should be setup for direct compile time dependencies.</p>
</div>
<div class="paragraph">
<p>Here is an example for the camel-ftp component</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;module xmlns="urn:jboss:module:1.1" name="org.apache.camel.component.ftp"&gt;
  &lt;resources&gt;
    &lt;resource-root path="camel-ftp-2.14.0.jar" /&gt;
  &lt;/resources&gt;
  &lt;dependencies&gt;
    &lt;module name="com.jcraft.jsch" /&gt;
    &lt;module name="javax.xml.bind.api" /&gt;
    &lt;module name="org.apache.camel.core" /&gt;
    &lt;module name="org.apache.commons.net" /&gt;
  &lt;/dependencies&gt;
&lt;/module&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please make sure you don&#8217;t duplicate modules that are already available in WildFly and can be reused.</p>
</div>
<h4 id="_add_a_reference_to_the_component" class="discrete">Add a reference to the component</h4>
<div class="paragraph">
<p>To make this module visible by default to arbitrary JavaEE deployments add a reference to <code>modules/system/layers/fuse/org/apache/camel/component/main/module.xml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-xml" data-lang="xml">&lt;module xmlns="urn:jboss:module:1.3" name="org.apache.camel.component"&gt;
  &lt;dependencies&gt;
    ...
    &lt;module name="org.apache.camel.component.ftp" export="true" services="export"/&gt;
  &lt;/dependencies&gt;
&lt;/module&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_formats">7. Data Formats</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following lists supported Data Formats</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://camel.apache.org/barcode-data-format.html" target="_blank">Barcode</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/base64.html" target="_blank">Base64</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/bindy.html" target="_blank">Bindy</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/castor.html" target="_blank">Castor</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/crypto.html" target="_blank">Crypto</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/csv.html" target="_blank">CSV</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/flatpack.html" target="_blank">Flatpack</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/gzip-data-format.html" target="_blank">GZip</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/hl7.html" target="_blank">HL7</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/json.html" target="_blank">JSON</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/jaxb.html" target="_blank">JAXB</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/protobuf.html" target="_blank">Protobuf</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/soap.html" target="_blank">SOAP</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/serialization.html" target="_blank">Serialization</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/syslog.html" target="_blank">Syslog</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/tidymarkup.html" target="_blank">TidyMarkup</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/xmlbeans.html" target="_blank">XmlBeans</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/xml-security-component.html" target="_blank">XMLSecurity</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/xstream.html" target="_blank">XStream</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/yaml-data-format.html" target="_blank">YAML</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/zip-file-dataformat.html" target="_blank">Zip</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_languages">8. Languages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following lists supported scripting languages</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://camel.apache.org/beanshell.html" target="_blank">BeanShell</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/groovy.html" target="_blank">Groovy</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/ruby.html" target="_blank">Ruby</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/python.html" target="_blank">Python</a></p>
</li>
<li>
<p><a href="http://camel.apache.org/javascript.html" target="_blank">JavaScript</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cloud_integration">9. Cloud Integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter details information about cloud integration</p>
</div>
<div class="sect2">
<h3 id="_openshift_local">9.1. OpenShift Local</h3>
<div class="paragraph">
<p>Here we follow the instructions on <a href="https://www.openshift.org" target="_blank">Try Origin</a>.
We use the <a href="https://www.openshift.org/vm" target="_blank">all-in-one VM</a> approach through a Vagrant VirtualBox VM.</p>
</div>
<div class="paragraph">
<p>After having installed Vagrant and VirtualBox, we run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ vagrant init openshift/origin-all-in-one
$ vagrant up --provider=virtualbox
...
Successfully started and provisioned VM with 2 cores and 5 G of memory.
To modify the number of cores and/or available memory modify your local Vagrantfile</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now access the OpenShift console on: <a href="https://10.2.2.2:8443/console" class="bare" target="_blank">https://10.2.2.2:8443/console</a></p>
</div>
<div class="paragraph">
<p>Configured users are:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>admin/admin
user/user</pre>
</div>
</div>
<div class="paragraph">
<p>This should now also allow us to ssh into the VM</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ vagrant ssh
Last login: Mon Feb  8 09:06:26 2016 from 10.0.2.2</code></pre>
</div>
</div>
<div class="paragraph">
<p>and use the OpenShift command line client.</p>
</div>
<div class="sect3">
<h4 id="_client_tools">9.1.1. Client Tools</h4>
<div class="paragraph">
<p>The client tools are available <a href="https://10.2.2.2:8443/console/command-line" target="_blank">from the console</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_docker_access">9.1.2. Docker access</h4>
<div class="paragraph">
<p>The docker deamon running in the Vagrant VM needs be exposed on the network.
The easiest way to do this is to use the provided <a href="https://github.com/wildfly-extras/wildfly-camel/blob/master/Vagrantfile" target="_blank">Vagrantfile</a>.</p>
</div>
<div class="paragraph">
<p>The provided Vagrantfile adds port forwarding, a few docker deamon options and restarts the docker deamon.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>  config.vm.network "forwarded_port", guest: 8080, host: 8080
  config.vm.network "forwarded_port", guest: 8443, host: 8443
  config.vm.network "forwarded_port", guest: 2375, host: 2375</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[vagrant@localhost ~]$ sudo vi /etc/sysconfig/docker
# Additional startup options for the Docker daemon
OPTIONS="-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>[vagrant@localhost ~]$ sudo systemctl restart docker</code></pre>
</div>
</div>
<div class="paragraph">
<p>On you local machine, setup a route to the Vagrant VM</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ sudo cat /etc/hosts
10.2.2.2    origin</pre>
</div>
</div>
<div class="paragraph">
<p>and export a few Docker related environment variables for maven builds.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>export DOCKER_HOST=tcp://origin:2375
export DOCKER_IP=origin</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_running_wildfly_camel">9.1.3. Running WildFly-Camel</h4>
<div class="paragraph">
<p>With every WildFly-Camel release we also publish the latest <a href="https://registry.hub.docker.com/u/wildflyext/wildfly-camel/" target="_blank">wildflyext/wildfly-camel</a> image.</p>
</div>
<div class="paragraph">
<p>You can run the standalone container like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ docker run --rm -ti -e WILDFLY_MANAGEMENT_USER=admin -e WILDFLY_MANAGEMENT_PASSWORD=admin -p 8080:8080 -p 9990:9990 wildflyext/wildfly-camel</code></pre>
</div>
</div>
<div class="paragraph">
<p>and access the admin console like this: <a href="http://10.2.2.2:9990/console" class="bare" target="_blank">http://10.2.2.2:9990/console</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/console-standalone.png" alt="console standalone">
</div>
</div>
<div class="paragraph">
<p>The Hawt.io console is available at: <a href="http://10.2.2.2:8080/hawtio" class="bare" target="_blank">http://10.2.2.2:8080/hawtio</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/hawtio-camel-01.png" alt="hawtio camel 01">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_an_openshift_project">9.1.4. Create an OpenShift project</h4>
<div class="paragraph">
<p>Here we run a set of WildFly Camel servers on <a href="https://www.openshift.org" target="_blank">OpenShift Origin</a>.
The target platform is the local OpenShift instance that we created above.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/example-rest-design.png" alt="example rest design">
</div>
</div>
<div class="paragraph">
<p>The example architecture consists of a set of three high available (HA) servers running REST endpoints. For server replication and failover we use <a href="http://kubernetes.io" target="_blank">Kubernetes</a>.
Each server runs in a dedicated <a href="https://github.com/GoogleCloudPlatform/kubernetes/blob/v1.0.0/docs/pods.md" target="_blank">Pod</a>
that we access via <a href="https://github.com/GoogleCloudPlatform/kubernetes/blob/v1.0.0/docs/services.md" target="_blank">Services</a>.</p>
</div>
<div class="paragraph">
<p>A project allows us to create deployments, pods, services, routes, etc. under our own custom 'wildfly-camel' namespace.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc new-project wildfly-camel</pre>
</div>
</div>
<div class="sect4">
<h5 id="_create_a_new_application">Create a new application</h5>
<div class="paragraph">
<p>Now, lets create a new appliction from an existing wildfly-camel based image.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc new-app wildflyext/example-camel-rest</pre>
</div>
</div>
<div class="paragraph">
<p>and scale it up</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc scale --replicas=3 dc example-camel-rest</pre>
</div>
</div>
<div class="paragraph">
<p>After a while you should see the pod running</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/openshift-standalone-pods.png" alt="openshift standalone pods">
</div>
</div>
<div class="paragraph">
<p>The pods running the JAX-RS endpoints are however not yet exposed to the world.</p>
</div>
</div>
<div class="sect4">
<h5 id="_exposing_the_container_externally">Exposing the container externally</h5>
<div class="paragraph">
<p>Now, lets expose the HTTP root context of the running wildlfy server.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ oc expose service example-camel-rest</pre>
</div>
</div>
<div class="paragraph">
<p>From a remote client, you should now be able to access the service like this</p>
</div>
<div class="paragraph">
<p><a href="http://example-camel-rest-wildfly-camel.apps.10.2.2.2.xip.io/rest/greet/hello/Kermit" class="bare" target="_blank">http://example-camel-rest-wildfly-camel.apps.10.2.2.2.xip.io/rest/greet/hello/Kermit</a></p>
</div>
<div class="literalblock">
<div class="content">
<pre>Hello Kermit from 172.17.0.8</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_openshift_on_ec2">9.2. OpenShift on EC2</h3>
<div class="paragraph">
<p>Here we follow the instructions on <a href="https://www.openshift.org" target="_blank">Try Origin</a>
for <a href="https://github.com/openshift/origin/releases" target="_blank">binary releases VM</a>.</p>
</div>
<div class="paragraph">
<p>After having launched an instance of RHEL7 on EC2 we can <code>ssh</code> into the box.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ ssh -i ~/.ssh/id_rsa_ec2.pem ec2-user@1.2.3.4</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we <a href="https://docs.docker.com/engine/installation/linux/rhel" target="_blank">install Docker</a>
and add the <code>ec2-user</code> to the docker group.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ curl -fsSL https://get.docker.com/ | sh
$ sudo usermod -aG docker ec2-user
$ sudo systemctl enable docker.service
$ sudo systemctl start docker
$ docker run hello-world
...
Hello from Docker!
This message shows that your installation appears to be working correctly.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now download the OpenShift server and start it</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ curl -L https://github.com/openshift/origin/releases/download/v1.4.0-rc1/openshift-origin-server-v1.4.0-rc1.b4e0954-linux-64bit.tar.gz > openshift-origin-server-v1.4.0-rc1.tar.gz
$ tar xzf openshift-origin-server-v1.4.0-rc1.tar.gz
$ oc cluster up --public-hostname=ec2-1-2-3-4.eu-west-1.compute.amazonaws.com --routing-suffix=1.2.3.4.xip.io --skip-registry-check=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can now access the OpenShift console on: <a href="https://1.2.3.4:8443/console" class="bare" target="_blank">https://1.2.3.4:8443/console</a></p>
</div>
<div class="paragraph">
<p>The process of creating a project and application follows that of <a href="index.html#_openshift_local">OpenShift Local</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_source_to_image">9.3. Source To Image</h3>
<div class="paragraph">
<p>WildFly-Camel provides a <a href="https://docs.openshift.org/latest/architecture/core_concepts/builds_and_image_streams.html#source-build" target="_blank">Source-To-Image</a>
(S2I) <a href="https://hub.docker.com/r/wildflyext/s2i-wildfly-camel/" target="_blank">Docker image</a> which enables you to build reproducable images from source.</p>
</div>
<div class="sect3">
<h4 id="_example_s2i_build">9.3.1. Example S2I build</h4>
<div class="paragraph">
<p>First you&#8217;ll need to download and install the S2I tooling from <a href="https://github.com/openshift/source-to-image" target="_blank">here</a>.</p>
</div>
<div class="paragraph">
<p>Then you can build and run a Docker image from source. For example, to build the WildFly-Camel CDI quickstart:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ s2i build https://github.com/wildfly-extras/wildfly-camel-examples.git -r 4.4.0-SNAPSHOT --context-dir camel-cdi wildflyext/s2i-wildfly-camel:4.4.0-SNAPSHOT wildfly-camel-example-cdi
$ docker run -p 8080:8080 wildfly-camel-example-cdi</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_s2i_with_openshift_origin">9.3.2. S2I with OpenShift Origin</h4>
<div class="paragraph">
<p>For convenience, WildFly-Camel provides an OpenShift <a href="sources/wildfly-camel-imagestreams.json" target="_blank">ImageStream</a>
template and an <a href="sources/wildfly-camel-template.json" target="_blank">application template</a> which enable you to to perform S2I build and deployments in OpenShift origin.</p>
</div>
<div class="paragraph">
<p>First add the WildFly-Camel S2I ImageStream.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ oc apply -f http://wildfly-extras.github.io/wildfly-camel/sources/wildfly-camel-image-streams.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then add the application template.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code>$ oc apply -f http://wildfly-extras.github.io/wildfly-camel/sources/wildfly-camel-template.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>When you select 'Add to Project' in the OpenShift web console you should see a new catalog item named
's2i-wildfly-camel'. Choose this option, provide the required template parameters and click 'Create' to start the build process.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/wildfly-camel-s2i.png" alt="wildfly camel s2i">
</div>
</div>
<div class="paragraph">
<p>You&#8217;ll then be able to monitor your application S2I build and deployment in OpenShift. Eventually you should see your application with 1 pod running.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/wildfly-camel-s2i-deployed.png" alt="wildfly camel s2i deployed">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security_6">10. Security</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Security in WildFly is a broad topic. Both WildFly and Camel have well documented, stadardised methods of securing configuration, endpoints and payloads.</p>
</div>
<div class="sect2">
<h3 id="_jax_rs_security">10.1. JAX-RS Security</h3>
<div class="paragraph">
<p>The following topics explain how to secure JAX-RS endpoints.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.jboss.org/author/display/WFLY8/Authentication" target="_blank">WildFly HTTP basic authentication</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/author/display/WFLY8/Security+Realms" target="_blank">Security Realms &amp; SSL</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/author/display/WFLY8/Securing+EJBs" target="_blank">Securing EJBs</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_jax_ws_security">10.2. JAX-WS Security</h3>
<div class="paragraph">
<p>The following topics explain how to secure JAX-WS endpoints.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.jboss.org/author/display/WFLY8/Authentication" target="_blank">WildFly HTTP basic authentication</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/author/display/WFLY8/WS-Security" target="_blank">WS-Security</a></p>
</li>
<li>
<p><a href="http://cxf.apache.org/docs/security.html" target="_blank">CXF Security</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/author/display/WFLY8/Security+Realms" target="_blank">Security Realms &amp; SSL</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/author/display/WFLY8/Securing+EJBs" target="_blank">Securing EJBs</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_jms_security">10.3. JMS Security</h3>
<div class="paragraph">
<p>The following topics explain how to secure JMS endpoints.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://activemq.apache.org/artemis/docs/1.0.0/security.html" target="_blank">ActiveMQ Artemis security documentation</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/author/display/WFLY10/Messaging+configuration#Messagingconfiguration-SecuritySettingsforArtemisaddressesandJMSdestinations" target="_blank">Security settings for ActiveMQ Artemis addresses and JMS destinations</a></p>
</li>
<li>
<p><a href="https://docs.jboss.org/author/display/WFLY10/Messaging+configuration#Messagingconfiguration-SecurityDomainforUsers" target="_blank">ActiveMQ Artemis security domain configuration</a></p>
</li>
<li>
<p><a href="http://activemq.apache.org/security.html" target="_blank">ActiveMQ Security</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to that, we use Camel&#8217;s notion of Route Policies to integrate with the WildFly security system.</p>
</div>
</div>
<div class="sect2">
<h3 id="_route_policy">10.4. Route Policy</h3>
<div class="paragraph">
<p>Camel supports the notion of <a href="http://camel.apache.org/routepolicy.html" target="_blank">RoutePolicies</a>, which can be used to integrate with the WildFly security system. There are currently two supported scenarios for security integration.</p>
</div>
<div class="sect3">
<h4 id="_camel_calls_into_javaee">10.4.1. Camel calls into JavaEE</h4>
<div class="paragraph">
<p>When a camel route calls into a secured JavaEE component, it acts as a client and must provide appropriate credentials associated with the call.</p>
</div>
<div class="paragraph">
<p>The route can be decorated with a <code>ClientAuthorizationPolicy</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:start")
        .policy(new ClientAuthorizationPolicy())
        .to("ejb:java:module/AnnotatedSLSB?method=doSelected");
    }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>This does actually no do any authentication/authorization as part of the Camel message processing. Instead it associates the credentials that come with the Camel Exchange with the call into the EJB3 layer.</p>
</div>
<div class="paragraph">
<p>The client that calls the message consumer must provide appropriate credentials in the AUTHENTICATION header like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">ProducerTemplate producer = camelctx.createProducerTemplate();
Subject subject = new Subject();
subject.getPrincipals().add(new DomainPrincipal(domain));
subject.getPrincipals().add(new EncodedUsernamePasswordPrincipal(username, password));
producer.requestBodyAndHeader("direct:start", "Kermit", Exchange.AUTHENTICATION, subject, String.class);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Authentication and authorization will happen in the JavaEE layer.</p>
</div>
</div>
<div class="sect3">
<h4 id="_securing_a_camel_route">10.4.2. Securing a Camel Route</h4>
<div class="paragraph">
<p>In order to secure a Camel Route, we can associate a <code>DomainAuthorizationPolicy</code> with the route. This policy requires a successful authentication against the given security domain and authorization for "Role2".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">CamelContext camelctx = new DefaultCamelContext();
camelctx.addRoutes(new RouteBuilder() {
    @Override
    public void configure() throws Exception {
        from("direct:start")
        .policy(new DomainAuthorizationPolicy().roles("Role2"))
        .transform(body().prepend("Hello "));
    }
});
camelctx.start();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, the client that calls the message consumer must provide appropriate credentials in the AUTHENTICATION header like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight nowrap"><code class="language-java" data-lang="java">ProducerTemplate producer = camelctx.createProducerTemplate();
Subject subject = new Subject();
subject.getPrincipals().add(new DomainPrincipal(domain));
subject.getPrincipals().add(new EncodedUsernamePasswordPrincipal(username, password));
producer.requestBodyAndHeader("direct:start", "Kermit", Exchange.AUTHENTICATION, subject, String.class);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_developer_info">11. Developer Info</h2>
<div class="sectionbody">
<h3 id="_source" class="discrete">Source</h3>
<div class="paragraph">
<p><a href="https://github.com/wildfly-extras/wildfly-camel" class="bare">https://github.com/wildfly-extras/wildfly-camel</a></p>
</div>
<h3 id="_issues" class="discrete">Issues</h3>
<div class="paragraph">
<p><a href="https://github.com/wildfly-extras/wildfly-camel/issues" class="bare">https://github.com/wildfly-extras/wildfly-camel/issues</a></p>
</div>
<h3 id="_jenkins" class="discrete">Jenkins</h3>
<div class="paragraph">
<p><a href="https://ci.fabric8.io/job/wildfly-camel" class="bare">https://ci.fabric8.io/job/wildfly-camel</a></p>
</div>
<h3 id="_downloads" class="discrete">Downloads</h3>
<div class="paragraph">
<p><a href="https://github.com/wildfly-extras/wildfly-camel/releases" class="bare">https://github.com/wildfly-extras/wildfly-camel/releases</a></p>
</div>
<h3 id="_forums_lists_irc" class="discrete">Forums, Lists, IRC</h3>
<div class="paragraph">
<p>#wildfly-camel channel on irc.freenode.net</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 4.4.0-SNAPSHOT<br>
Last updated 2016-12-05 09:25:50 CET
</div>
</div>
</body>
</html>